# gateway-service 功能测试清单

> 网关服务 - API网关、路由转发、租户识别

**端口**: 9200
**职责**: API网关、路由转发、租户识别
**最后更新**: 2025-01-28

---

## 测试覆盖情况

| 指标 | 数值 |
|------|------|
| 功能数 | 5 |
| 已测试 | 0 |
| 待测试 | 5 |
| **覆盖率** | **0%** |

---

## 功能列表

| 功能 | 说明 | 测试用例 | 状态 |
|------|------|----------|------|
| 路由转发 | 将请求转发到对应服务 | - | ⏳ 待实现 |
| 租户识别 | 从请求中提取租户信息 | - | ⏳ 待实现 |
| 统一鉴权 | JWT Token验证 | - | ⏳ 待实现 |
| 限流熔断 | 保护下游服务 | - | ⏳ 待实现 |
| API日志 | 请求响应日志记录 | - | ⏳ 待实现 |

---

## 测试文件

暂无测试文件

---

## 配置模型

### 路由配置

```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: tenant-service
          uri: lb://tenant-service
          predicates:
            - Path=/api/tenants/**
          filters:
            - StripPrefix=1
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/users/**
            - Path=/api/auth/**
          filters:
            - StripPrefix=1
```

### 全局过滤器
- 租户识别过滤器 (TenantIdentificationFilter)
- JWT认证过滤器 (AuthenticationFilter)
- 日志记录过滤器 (LoggingFilter)
- 限流过滤器 (RateLimitFilter)

---

## 待实现功能

### P0 - 核心功能（高优先级）

**注意**: 本服务需从头实现

1. **基础功能实现**
   - [ ] 创建Gateway启动类
   - [ ] 配置pom.xml依赖
   - [ ] 配置application.yml

2. **路由转发**
   - [ ] 配置各服务路由规则
   - [ ] 负载均衡配置
   - [ ] 路径重写规则

3. **租户识别**
   - [ ] 从Header提取租户ID
   - [ ] 从子域名提取租户
   - [ ] 租户上下文传递
   - [ ] 租户有效性校验

4. **统一鉴权**
   - [ ] JWT Token解析
   - [ ] Token有效性验证
   - [ ] 白名单路径配置
   - [ ] 用户信息传递

### P1 - 重要功能（中优先级）
5. **限流熔断**
   - [ ] 基于Redis的限流
   - [ ] 熔断器配置
   - [ ] 降级策略

6. **API日志**
   - [ ] 请求日志记录
   - [ ] 响应日志记录
   - [ ] 异常日志记录
   - [ ] 日志格式化输出

7. **跨域配置**
   - [ ] CORS配置
   - [ ] 预检请求处理

8. **测试用例编写**
   - [ ] Gateway路由测试
   - [ ] 过滤器单元测试
   - [ ] 集成测试

---

## 开发检查清单

### 阶段1: 基础设施
- [ ] 创建模块结构
- [ ] 配置Spring Cloud Gateway依赖
- [ ] 配置Nacos服务发现
- [ ] 配置基础路由

### 阶段2: 核心功能
- [ ] 实现租户识别过滤器
- [ ] 实现JWT认证过滤器
- [ ] 配置白名单路径

### 阶段3: 高级功能
- [ ] 配置限流规则
- [ ] 配置熔断降级
- [ ] 实现日志过滤器

### 阶段4: 测试验证
- [ ] 路由转发测试
- [ ] 鉴权功能测试
- [ ] 限流熔断测试
- [ ] 集成测试
