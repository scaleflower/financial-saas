# 财务报销系统 - 功能点清单

## 📋 功能模块总览

本文档列出财务报销系统的所有功能点，用于逐个进行详细设计和开发。

### 功能点数量统计

| 模块类别 | 模块数量 | 功能点数量 |
|---------|---------|----------|
| 基础管理 | 4 | 32 |
| 业务管理 | 3 | 45 |
| 工作流管理 | 1 | 12 |
| 插件化功能 | 2 | 18 |
| 系统管理 | 3 | 15 |
| **合计** | **13** | **122** |

---

## 模块1：租户管理 (4功能点)

### 1.1 租户注册

**功能点ID**: TENANT-001  
**功能名称**: 租户注册  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 管理员创建新租户（公司/组织）
- 填写租户基本信息
- 设置租户初始配置

**主要功能**:
- [ ] 租户基本信息录入（代码、名称、类型、联系人等）
- [ ] 租户配置初始化（用户数量、存储空间等）
- [ ] 租户状态设置（待审核/正常）
- [ ] 租户管理员创建（默认租户管理员）

**输入**:
- 租户代码（唯一）
- 租户名称
- 租户类型（公司/部门）
- 联系人信息
- 初始配置（用户数、存储空间）
- 管理员账号信息

**输出**:
- 租户ID
- 租户初始配置
- 管理员账号创建成功

**业务规则**:
- 租户代码必须全局唯一
- 租户名称不能为空
- 联系人邮箱和手机至少填写一个
- 管理员用户名在租户内唯一

**数据表**: tenant

---

### 1.2 租户信息管理

**功能点ID**: TENANT-002  
**功能名称**: 租户信息管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 查询、编辑租户基本信息
- 更新租户配置
- 管理租户状态

**主要功能**:
- [ ] 租户列表查询（分页、搜索、筛选）
- [ ] 租户详情查看
- [ ] 租户基本信息编辑
- [ ] 租户配置更新
- [ ] 租户状态管理（正常/停用/过期）
- [ ] 租户续费（更新过期日期）
- [ ] 租户导出（Excel）

**输入**:
- 查询条件（租户代码、名称、状态等）
- 编辑表单
- 状态操作

**输出**:
- 租户列表
- 租户详情
- 操作结果

**业务规则**:
- 停用租户不能编辑基本信息
- 过期租户不能登录
- 续费后自动恢复正常状态
- 修改配置需要管理员权限

**数据表**: tenant

---

### 1.3 租户配额管理

**功能点ID**: TENANT-003  
**功能名称**: 租户配额管理  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 管理租户的使用配额
- 监控租户资源使用情况
- 租户配额预警

**主要功能**:
- [ ] 用户数量配额设置
- [ ] 存储空间配额设置
- [ ] 数据库连接数配额设置
- [ ] 并发请求数配额设置
- [ ] 配额使用情况查询
- [ ] 配额超限预警（邮件/系统通知）
- [ ] 配额历史记录

**输入**:
- 配额类型
- 配额值
- 预警阈值

**输出**:
- 配额列表
- 使用情况统计
- 预警通知

**业务规则**:
- 达到配额80%触发预警
- 达到配额100%禁止操作
- 系统管理员可以临时突破配额
- 配额变更需要记录审计日志

**数据表**: tenant, audit_log

---

### 1.4 租户统计报表

**功能点ID**: TENANT-004  
**功能名称**: 租户统计报表  
**优先级**: P2 (一般功能）  
**状态**: 待设计

**功能描述**:
- 统计租户使用情况
- 生成租户运营报表
- 租户活跃度分析

**主要功能**:
- [ ] 租户活跃用户数统计
- [ ] 租户业务单据数统计（按日/周/月）
- [ ] 租户存储空间使用统计
- [ ] 租户API调用次数统计
- [ ] 租户活跃度评分计算
- [ ] 租户排名（按活跃度/业务量）
- [ ] 报表导出（Excel/PDF）

**输入**:
- 统计时间范围
- 统计维度（日/周/月）
- 排序方式

**输出**:
- 统计报表数据
- 图表数据（折线图、柱状图、饼图）
- 导出文件

**业务规则**:
- 统计数据延迟1小时更新
- 报表只对系统管理员可见
- 支持多维度组合查询

**数据表**: tenant, trans, loan, repayment, audit_log

---

## 模块2：用户管理 (8功能点)

### 2.1 用户注册

**功能点ID**: USER-001  
**功能名称**: 用户注册  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 租户管理员创建新用户
- 批量导入用户
- 用户初始密码设置

**主要功能**:
- [ ] 单个用户注册（表单填写）
- [ ] Excel批量导入用户
- [ ] 用户信息验证（用户名、邮箱、手机唯一性）
- [ ] 密码生成（默认密码或随机密码）
- [ ] 组织分配
- [ ] 角色分配（默认角色）
- [ ] 用户激活（邮件/短信）
- [ ] 批量导入结果报告

**输入**:
- 用户基本信息
- 批量导入文件
- 组织和角色选择

**输出**:
- 用户ID
- 创建结果
- 批量导入报告

**业务规则**:
- 用户名在同一租户内唯一
- 邮箱在同一租户内唯一
- 手机号在同一租户内唯一
- 工号在同一租户内唯一
- 必须分配至少一个角色
- 必须关联到一个组织
- 初始密码必须符合安全策略

**数据表**: user, user_role

---

### 2.2 用户信息管理

**功能点ID**: USER-002  
**功能名称**: 用户信息管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 查询、编辑用户基本信息
- 用户头像上传
- 用户状态管理

**主要功能**:
- [ ] 用户列表查询（分页、搜索、筛选）
- [ ] 用户详情查看
- [ ] 用户基本信息编辑
- [ ] 用户头像上传和管理
- [ ] 用户状态管理（正常/锁定/停用/删除）
- [ ] 用户组织调整
- [ ] 用户角色调整
- [ ] 用户导出（Excel）

**输入**:
- 查询条件（用户名、姓名、状态、组织等）
- 编辑表单
- 状态操作

**输出**:
- 用户列表
- 用户详情
- 操作结果

**业务规则**:
- 用户名不能修改
- 锁定用户不能登录
- 停用用户不能操作业务
- 删除用户前检查是否有未完成的业务
- 组织调整需要记录审计日志

**数据表**: user, user_role, audit_log

---

### 2.3 用户登录

**功能点ID**: USER-003  
**功能名称**: 用户登录  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 用户名密码登录
- 钉钉扫码登录
- 登录验证和JWT生成

**主要功能**:
- [ ] 用户名密码登录
- [ ] 钉钉扫码登录
- [ ] 登录验证（用户状态、密码校验）
- [ ] JWT Token生成
- [ ] 登录失败次数记录
- [ ] 登录失败锁定（超过阈值）
- [ ] 最后登录信息记录（IP、时间、设备）
- [ ] 登录日志记录
- [ ] Token刷新机制

**输入**:
- 用户名和密码
- 钉钉授权码

**输出**:
- JWT Token
- Token过期时间
- 用户信息

**业务规则**:
- 用户状态必须为正常
- 密码错误超过5次锁定账户30分钟
- 记录登录失败次数
- Token默认有效期24小时
- 支持Token刷新（有效期7天）

**数据表**: user, audit_log

---

### 2.4 密码管理

**功能点ID**: USER-004  
**功能名称**: 密码管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 用户修改密码
- 管理员重置用户密码
- 密码策略管理

**主要功能**:
- [ ] 用户修改密码（旧密码验证）
- [ ] 管理员重置用户密码
- [ ] 密码发送（邮件/短信）
- [ ] 密码重置链接生成
- [ ] 密码重置链接验证
- [ ] 密码策略配置（长度、复杂度等）
- [ ] 密码历史检查（不能重复最近3次）
- [ ] 密码修改成功通知

**输入**:
- 旧密码
- 新密码
- 确认密码

**输出**:
- 操作结果
- 密码重置链接/临时密码

**业务规则**:
- 旧密码必须正确
- 新密码必须符合密码策略
- 新密码不能与旧密码相同
- 新密码不能是最近3次使用过的密码
- 临时密码必须修改后才能继续操作
- 重置密码链接24小时内有效

**数据表**: user, audit_log

---

### 2.5 钉钉集成

**功能点ID**: USER-005  
**功能名称**: 钉钉集成  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 钉钉用户同步
- 钉钉扫码登录
- 钉钉组织同步
- 钉钉消息通知

**主要功能**:
- [ ] 钉钉用户同步（从钉钉导入用户）
- [ ] 钉钉用户信息更新
- [ ] 钉钉扫码登录授权
- [ ] 钉钉组织架构同步
- [ ] 钉钉消息推送（审批通知）
- [ ] 钉钉免登配置
- [ ] 钉钉绑定/解绑

**输入**:
- 钉钉授权码
- 同步配置

**输出**:
- 同步用户数量
- 登录Token
- 同步结果报告

**业务规则**:
- 钉钉用户ID不能重复绑定
- 钉钉用户信息作为扩展信息
- 支持钉钉和本地账号共存
- 同步失败记录日志

**数据表**: user, org, audit_log

---

### 2.6 用户组织管理

**功能点ID**: USER-006  
**功能名称**: 用户组织管理  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 用户组织关联管理
- 用户组织调整
- 组织内用户列表

**主要功能**:
- [ ] 分配用户到组织
- [ ] 调整用户所属组织
- [ ] 查询组织内用户列表
- [ ] 用户组织历史查询
- [ ] 用户组织树展示
- [ ] 批量调整用户组织

**输入**:
- 用户ID列表
- 目标组织ID

**输出**:
- 操作结果
- 组织用户列表

**业务规则**:
- 用户只能属于一个主组织
- 可以属于多个虚拟组织
- 调整组织需要审计日志
- 不能调整到不存在的组织

**数据表**: user, org, audit_log

---

### 2.7 用户角色管理

**功能点ID**: USER-007  
**功能名称**: 用户角色管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 用户角色分配
- 用户角色撤销
- 用户角色查询

**主要功能**:
- [ ] 分配角色给用户
- [ ] 撤销用户角色
- [ ] 查询用户的角色列表
- [ ] 查询角色下的用户列表
- [ ] 批量分配角色
- [ ] 临时角色分配（带过期时间）
- [ ] 角色历史查询

**输入**:
- 用户ID
- 角色ID
- 过期时间（可选）

**输出**:
- 操作结果
- 角色列表

**业务规则**:
- 用户必须有至少一个角色
- 系统角色不能被撤销
- 临时角色过期自动撤销
- 角色分配需要审计日志

**数据表**: user_role, audit_log

---

### 2.8 用户查询与导出

**功能点ID**: USER-008  
**功能名称**: 用户查询与导出  
**优先级**: P2 (一般功能）  
**状态**: 待设计

**功能描述**:
- 用户列表查询（多条件）
- 用户详情查看
- 用户数据导出

**主要功能**:
- [ ] 用户列表查询（分页、搜索、筛选）
- [ ] 多条件组合查询（用户名、姓名、组织、角色、状态）
- [ ] 用户详情查看
- [ ] 用户导出（Excel）
- [ ] 用户导出（PDF）
- [ ] 用户字段自定义导出
- [ ] 用户统计报表

**输入**:
- 查询条件
- 导出格式
- 导出字段

**输出**:
- 用户列表
- 用户详情
- 导出文件

**业务规则**:
- 敏感字段导出需要权限
- 导出数据需要审计日志
- 导出文件大小限制

**数据表**: user, user_role, org

---

## 模块3：组织管理 (6功能点)

### 3.1 组织创建

**功能点ID**: ORG-001  
**功能名称**: 组织创建  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 创建新的组织
- 设置组织负责人
- 设置组织层级

**主要功能**:
- [ ] 组织基本信息录入（代码、名称、类型）
- [ ] 组织类型选择（公司/部门/团队）
- [ ] 组织层级设置（1级/2级/3级...）
- [ ] 父组织选择
- [ ] 组织负责人设置
- [ ] 组织地址和联系信息
- [ ] 组织备注

**输入**:
- 组织基本信息
- 父组织ID
- 负责人ID

**输出**:
- 组织ID
- 创建结果

**业务规则**:
- 组织代码在同一租户内唯一
- 组织名称在同一租户内唯一
- 组织层级不能超过5级
- 父组织必须存在
- 负责人必须是租户内的用户
- 不能创建循环引用（A的子组织是A的父组织）

**数据表**: org

---

### 3.2 组织信息管理

**功能点ID**: ORG-002  
**功能名称**: 组织信息管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 查询、编辑组织信息
- 组织树展示
- 组织层级调整

**主要功能**:
- [ ] 组织树展示
- [ ] 组织列表查询
- [ ] 组织详情查看
- [ ] 组织信息编辑
- [ ] 组织负责人调整
- [ ] 组织层级调整
- [ ] 组织排序调整
- [ ] 组织导出

**输入**:
- 组织ID
- 编辑表单

**输出**:
- 组织树结构
- 组织列表
- 操作结果

**业务规则**:
- 不能调整到自己的子组织（避免循环）
- 调整层级会影响下属组织
- 删除组织前需要检查是否有子组织和用户

**数据表**: org, audit_log

---

### 3.3 组织成员管理

**功能点ID**: ORG-003  
**功能名称**: 组织成员管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 查询组织内成员
- 添加成员到组织
- 移除组织成员

**主要功能**:
- [ ] 查询组织内用户列表
- [ ] 批量添加成员到组织
- [ ] 调整成员组织
- [ ] 查询用户组织历史
- [ ] 组织成员统计
- [ ] 导出组织成员列表

**输入**:
- 组织ID
- 用户ID列表

**输出**:
- 组织成员列表
- 操作结果

**业务规则**:
- 用户只能属于一个主组织
- 调整成员组织需要审计日志

**数据表**: user, org, audit_log

---

### 3.4 组织负责人管理

**功能点ID**: ORG-004  
**功能名称**: 组织负责人管理  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 设置组织负责人
- 查询负责人信息
- 负责人历史记录

**主要功能**:
- [ ] 设置组织负责人
- [ ] 查询组织负责人
- [ ] 查询负责人管理的组织
- [ ] 负责人历史记录
- [ ] 批量设置负责人

**输入**:
- 组织ID
- 负责人ID

**输出**:
- 操作结果
- 负责人列表

**业务规则**:
- 负责人必须是租户内的用户
- 一个用户可以负责多个组织
- 设置负责人需要审计日志

**数据表**: org, audit_log

---

### 3.5 组织权限管理

**功能点ID**: ORG-005  
**功能名称**: 组织权限管理  
**优先级**: P2 (一般功能）  
**状态**: 待设计

**功能描述**:
- 组织级别权限配置
- 组织数据范围控制

**主要功能**:
- [ ] 设置组织数据范围
- [ ] 组织数据权限查询
- [ ] 组织权限继承

**输入**:
- 组织ID
- 数据范围

**输出**:
- 操作结果

**业务规则**:
- 子组织继承父组织权限
- 数据范围：本组织/本组织及子组织/本部门/本部门及子部门/仅自己

**数据表**: role, org

---

### 3.6 组织树可视化

**功能点ID**: ORG-006  
**功能名称**: 组织树可视化  
**优先级**: P2 (一般功能）  
**状态**: 待设计

**功能描述**:
- 组织树图形化展示
- 组织节点操作
- 组织树导出

**主要功能**:
- [ ] 组织树图形展示
- [ ] 组织节点折叠/展开
- [ ] 组织节点搜索
- [ ] 组织树导出（图片/PDF）
- [ ] 组织统计信息展示

**输入**:
- 组织ID

**输出**:
- 组织树结构
- 组织统计

**数据表**: org, user

---

## 模块4：角色权限管理 (10功能点)

### 4.1 角色创建

**功能点ID**: ROLE-001  
**功能名称**: 角色创建  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 创建新角色
- 设置角色基本信息
- 分配角色权限

**主要功能**:
- [ ] 角色基本信息录入
- [ ] 角色类型选择（系统角色/业务角色/组织角色）
- [ ] 角色描述
- [ ] 组织关联（组织角色）
- [ ] 分配权限
- [ ] 设置数据范围
- [ ] 角色排序

**输入**:
- 角色基本信息
- 权限列表
- 数据范围

**输出**:
- 角色ID
- 创建结果

**业务规则**:
- 角色代码在同一租户内唯一
- 角色名称在同一租户内唯一
- 系统角色不能删除
- 组织角色必须关联到组织

**数据表**: role, role_perm

---

### 4.2 角色信息管理

**功能点ID**: ROLE-002  
**功能名称**: 角色信息管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 查询、编辑角色信息
- 角色状态管理
- 角色权限调整

**主要功能**:
- [ ] 角色列表查询
- [ ] 角色详情查看
- [ ] 角色信息编辑
- [ ] 角色状态管理（启用/禁用）
- [ ] 角色权限调整
- [ ] 角色数据范围调整
- [ ] 角色排序调整
- [ ] 角色导出

**输入**:
- 角色ID
- 编辑表单

**输出**:
- 角色列表
- 操作结果

**业务规则**:
- 禁用角色后，拥有该角色的用户不能操作
- 调整权限需要审计日志

**数据表**: role, role_perm, audit_log

---

### 4.3 角色权限分配

**功能点ID**: ROLE-003  
**功能名称**: 角色权限分配  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 为角色分配权限
- 撤销角色权限
- 批量操作

**主要功能**:
- [ ] 权限树展示
- [ ] 权限多选
- [ ] 分配权限给角色
- [ ] 撤销角色权限
- [ ] 批量分配权限
- [ ] 权限分组筛选
- [ ] 权限搜索

**输入**:
- 角色ID
- 权限ID列表

**输出**:
- 操作结果

**业务规则**:
- 系统角色权限不能修改
- 权限分配需要审计日志

**数据表**: role, role_perm, audit_log

---

### 4.4 角色数据范围

**功能点ID**: ROLE-004  
**功能名称**: 角色数据范围  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 设置角色数据范围
- 组织数据范围列表

**主要功能**:
- [ ] 数据范围设置（全部/本部门/本部门及子部门/仅自己）
- [ ] 数据范围部门选择
- [ ] 数据范围预览
- [ ] 数据范围验证

**输入**:
- 角色ID
- 数据范围类型
- 组织ID列表

**输出**:
- 操作结果

**业务规则**:
- 全部数据范围：访问所有数据
- 本部门：只能访问本组织及子组织数据
- 本部门及子部门：只能访问指定组织及其子组织数据
- 仅自己：只能访问自己创建的数据

**数据表**: role

---

### 4.5 权限创建

**功能点ID**: PERM-001  
**功能名称**: 权限创建  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 创建新权限
- 设置权限基本信息
- 权限分类

**主要功能**:
- [ ] 权限代码录入
- [ ] 权限名称录入
- [ ] 权限描述
- [ ] 权限分类（用户/报销/借款/还款/系统）
- [ ] 权限类型（菜单/按钮/API）
- [ ] 权限路径（菜单路径/API路径）
- [ ] HTTP方法（API权限）
- [ ] 父权限选择

**输入**:
- 权限基本信息

**输出**:
- 权限ID
- 创建结果

**业务规则**:
- 权限代码全局唯一
- 权限名称全局唯一
- 权限分组内唯一
- 权限类型和路径必须匹配

**数据表**: perm

---

### 4.6 权限信息管理

**功能点ID**: PERM-002  
**功能名称**: 权限信息管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 查询、编辑权限信息
- 权限状态管理
- 权限树维护

**主要功能**:
- [ ] 权限列表查询
- [ ] 权限详情查看
- [ ] 权限信息编辑
- [ ] 权限状态管理（启用/禁用）
- [ ] 权限树展示
- [ ] 权限树调整
- [ ] 权限分组管理
- [ ] 权限排序调整

**输入**:
- 权限ID
- 编辑表单

**输出**:
- 权限树
- 操作结果

**业务规则**:
- 禁用权限后，该权限对应的按钮/API不可访问
- 权限树层级不能超过5级

**数据表**: perm

---

### 4.7 菜单权限管理

**功能点ID**: PERM-003  
**功能名称**: 菜单权限管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 管理前端菜单权限
- 菜单树配置
- 菜单图标和排序

**主要功能**:
- [ ] 菜单树展示
- [ ] 菜单节点添加
- [ ] 菜单节点编辑
- [ ] 菜单节点删除
- [ ] 菜单节点拖拽排序
- [ ] 菜单图标选择
- [ ] 菜单链接配置
- [ ] 菜单显示/隐藏

**输入**:
- 菜单ID
- 编辑表单

**输出**:
- 菜单树
- 操作结果

**业务规则**:
- 菜单树层级不能超过5级
- 菜单链接必须是有效的路由路径
- 隐藏菜单的子菜单也需要隐藏

**数据表**: perm

---

### 4.8 按钮权限管理

**功能点ID**: PERM-004  
**功能名称**: 按钮权限管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 管理页面按钮权限
- 按钮权限与角色关联

**主要功能**:
- [ ] 按钮权限列表
- [ ] 按钮权限创建
- [ ] 按钮权限编辑
- [ ] 按钮权限删除
- [ ] 按钮权限分类

**输入**:
- 按钮权限信息

**输出**:
- 操作结果

**业务规则**:
- 按钮权限必须关联到菜单权限
- 删除按钮权限前检查是否被使用

**数据表**: perm

---

### 4.9 API权限管理

**功能点ID**: PERM-005  
**功能名称**: API权限管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 管理API接口权限
- API权限与角色关联

**主要功能**:
- [ ] API权限列表
- [ ] API权限创建
- [ ] API权限编辑
- [ ] API权限删除
- [ ] API权限测试
- [ ] API权限分组

**输入**:
- API权限信息（路径、方法）

**输出**:
- 操作结果

**业务规则**:
- API路径必须是有效的Spring MVC路径
- HTTP方法必须是有效的HTTP方法
- API权限自动生成到路由表

**数据表**: perm

---

### 4.10 权限验证

**功能点ID**: PERM-006  
**功能名称**: 权限验证  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 权限验证中间件
- 菜单权限验证
- 按钮权限验证
- API权限验证

**主要功能**:
- [ ] 从Token解析用户权限
- [ ] 菜单权限验证
- [ ] 按钮权限验证
- [ ] API权限验证
- [ ] 数据范围权限验证
- [ ] 权限缓存

**输入**:
- 用户Token
- 权限标识

**输出**:
- 是否有权限

**业务规则**:
- 权限验证结果缓存（减少数据库查询）
- 系统管理员拥有所有权限
- 超级管理员权限不能被修改

**数据表**: role, role_perm, perm

---

## 模块5：项目管理 (6功能点)

### 5.1 项目创建

**功能点ID**: PROJ-001  
**功能名称**: 项目创建  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 创建新项目
- 设置项目基本信息
- 分配项目成员

**主要功能**:
- [ ] 项目基本信息录入
- [ ] 项目类型选择
- [ ] 项目时间设置
- [ ] 项目预算设置
- [ ] 项目负责人设置
- [ ] 项目成员添加
- [ ] 项目备注

**输入**:
- 项目基本信息
- 负责人ID
- 成员ID列表

**输出**:
- 项目ID
- 创建结果

**业务规则**:
- 项目代码在同一租户内唯一
- 项目名称在同一租户内唯一
- 项目必须有负责人
- 项目开始时间不能晚于结束时间

**数据表**: project

---

### 5.2 项目信息管理

**功能点ID**: PROJ-002  
**功能名称**: 项目信息管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 查询、编辑项目信息
- 项目状态管理

**主要功能**:
- [ ] 项目列表查询
- [ ] 项目详情查看
- [ ] 项目信息编辑
- [ ] 项目状态管理（规划中/进行中/已完成/已取消）
- [ ] 项目进度更新
- [ ] 项目预算调整
- [ ] 项目时间调整
- [ ] 项目导出

**输入**:
- 项目ID
- 编辑表单

**输出**:
- 项目列表
- 项目详情

**业务规则**:
- 完成的项目不能编辑基本信息
- 删除项目前检查是否有关联单据

**数据表**: project, audit_log

---

### 5.3 项目成员管理

**功能点ID**: PROJ-003  
**功能名称**: 项目成员管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 项目成员添加
- 项目成员移除
- 项目成员角色设置

**主要功能**:
- [ ] 项目成员列表
- [ ] 添加项目成员
- [ ] 移除项目成员
- [ ] 项目成员角色设置
- [ ] 项目成员批量添加
- [ ] 项目成员导出

**输入**:
- 项目ID
- 用户ID
- 成员角色

**输出**:
- 项目成员列表

**业务规则**:
- 成员必须在项目所属租户内
- 删除成员前检查是否有未完成的任务

**数据表**: project, audit_log

---

### 5.4 项目预算管理

**功能点ID**: PROJ-004  
**功能名称**: 项目预算管理  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 项目预算设置
- 预算使用情况查询
- 预算预警

**主要功能**:
- [ ] 项目预算设置
- [ ] 预算调整
- [ ] 预算使用查询
- [ ] 预算使用率计算
- [ ] 预算超支预警
- [ ] 预算报表

**输入**:
- 项目ID
- 预算金额

**输出**:
- 预算信息
- 使用情况

**业务规则**:
- 预算使用率超过80%触发预警
- 预算使用率超过100%禁止新增单据
- 预算只能减少不能增加（特殊审批除外）

**数据表**: project, trans, loan, repayment

---

### 5.5 项目进度管理

**功能点ID**: PROJ-005  
**功能名称**: 项目进度管理  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 项目进度设置
- 进度自动计算
- 进度报表

**主要功能**:
- [ ] 手动设置进度
- [ ] 根据任务单据自动计算进度
- [ ] 进度百分比展示
- [ ] 进度历史记录
- [ ] 进度报表
- [ ] 进度甘特图

**输入**:
- 项目ID
- 进度值

**输出**:
- 进度信息

**业务规则**:
- 进度范围0-100%
- 自动计算优先于手动设置

**数据表**: project

---

### 5.6 项目查询与统计

**功能点ID**: PROJ-006  
**功能名称**: 项目查询与统计  
**优先级**: P2 (一般功能）  
**状态**: 待设计

**功能描述**:
- 项目列表查询
- 项目统计报表
- 项目导出

**主要功能**:
- [ ] 项目列表查询（分页、搜索、筛选）
- [ ] 项目状态统计
- [ ] 项目类型统计
- [ ] 项目成员统计
- [ ] 项目预算使用统计
- [ ] 项目导出（Excel/PDF）
- [ ] 项目数据可视化

**输入**:
- 查询条件
- 统计维度

**输出**:
- 项目列表
- 统计数据

**业务规则**:
- 已删除项目不在统计范围

**数据表**: project, trans, loan, repayment

---

## 模块6：基础数据管理 (8功能点)

### 6.1 币种管理

**功能点ID**: BASE-001  
**功能名称**: 币种管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 币种创建和编辑
- 币种列表查询
- 币种启用/禁用

**主要功能**:
- [ ] 币种列表查询
- [ ] 币种创建
- [ ] 币种编辑
- [ ] 币种启用/禁用
- [ ] 币种排序调整
- [ ] 币种图标管理
- [ ] 币种符号管理

**输入**:
- 币种信息

**输出**:
- 币种列表
- 操作结果

**业务规则**:
- 币种代码全局唯一
- 币种名称全局唯一
- 已禁用币种不能新增单据

**数据表**: currency

---

### 6.2 汇率管理

**功能点ID**: BASE-002  
**功能名称**: 汇率管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 汇率录入
- 汇率查询
- 汇率生效管理

**主要功能**:
- [ ] 汇率列表查询
- [ ] 汇率录入
- [ ] 汇率编辑
- [ ] 汇率生效日期设置
- [ ] 汇率失效日期设置
- [ ] 汇率查询（根据日期获取）
- [ ] 汇率批量导入
- [ ] 汇率导出

**输入**:
- 源币种
- 目标币种
- 汇率
- 生效日期

**输出**:
- 汇率列表
- 查询结果

**业务规则**:
- 同一源币种、目标币种、生效日期不能重复
- 汇率必须大于0
- 查询汇率优先使用最新生效的汇率
- 历史汇率保留用于单据查询

**数据表**: exchange_rate

---

### 6.3 报销类型管理

**功能点ID**: BASE-003  
**功能名称**: 报销类型管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 报销类型创建和编辑
- 报销类型列表查询
- 报销类型启用/禁用

**主要功能**:
- [ ] 报销类型列表查询
- [ ] 报销类型创建
- [ ] 报销类型编辑
- [ ] 报销类型启用/禁用
- [ ] 报销类型排序调整
- [ ] 报销类型图标管理

**输入**:
- 报销类型信息

**输出**:
- 报销类型列表
- 操作结果

**业务规则**:
- 报销类型代码在同一租户内唯一
- 报销类型名称在同一租户内唯一
- 已禁用报销类型不能新增单据

**数据表**: trans_type

---

### 6.4 费用类型管理

**功能点ID**: BASE-004  
**功能名称**: 费用类型管理  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 费用类型创建和编辑
- 费用类型列表查询
- 费用类型启用/禁用

**主要功能**:
- [ ] 费用类型列表查询
- [ ] 费用类型创建
- [ ] 费用类型编辑
- [ ] 费用类型启用/禁用
- [ ] 费用类型分类
- [ ] 费用类型排序调整
- [ ] 预算控制设置

**输入**:
- 费用类型信息

**输出**:
- 费用类型列表
- 操作结果

**业务规则**:
- 费用类型代码在同一租户内唯一
- 费用类型名称在同一租户内唯一
- 已禁用费用类型不能新增单据

**数据表**: expense_item_type

---

### 6.5 补贴标准管理

**功能点ID**: BASE-005  
**功能名称**: 补贴标准管理  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 补贴标准创建
- 补贴标准查询
- 补贴标准与城市/地区关联

**主要功能**:
- [ ] 补贴标准列表查询
- [ ] 补贴标准创建
- [ ] 补贴标准编辑
- [ ] 补贴标准启用/禁用
- [ ] 补贴标准与城市关联
- [ ] 补贴标准与费用类型关联
- [ ] 补贴标准金额设置
- [ ] 补贴计算规则设置

**输入**:
- 补贴标准信息

**输出**:
- 补贴标准列表
- 操作结果

**业务规则**:
- 补贴标准必须关联到城市
- 补贴标准必须关联到费用类型
- 补贴标准按城市和费用类型生效

**数据表**: allowance, city, expense_item_type

---

### 6.6 城市管理

**功能点ID**: BASE-006  
**功能名称**: 城市管理  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 城市创建和编辑
- 城市列表查询
- 城市层级管理

**主要功能**:
- [ ] 城市列表查询
- [ ] 城市创建
- [ ] 城市编辑
- [ ] 城市启用/禁用
- [ ] 城市层级管理（省/市/区）
- [ ] 城市搜索
- [ ] 城市树展示

**输入**:
- 城市信息

**输出**:
- 城市列表
- 城市树

**业务规则**:
- 城市代码全局唯一
- 城市名称全局唯一
- 城市层级：省 -> 市 -> 区

**数据表**: city

---

### 6.7 项目类型管理

**功能点ID**: BASE-007  
**功能名称**: 项目类型管理  
**优先级**: P2 (一般功能）  
**状态**: 待设计

**功能描述**:
- 项目类型创建和编辑
- 项目类型列表查询
- 项目类型启用/禁用

**主要功能**:
- [ ] 项目类型列表查询
- [ ] 项目类型创建
- [ ] 项目类型编辑
- [ ] 项目类型启用/禁用
- [ ] 项目类型排序调整

**输入**:
- 项目类型信息

**输出**:
- 项目类型列表
- 操作结果

**业务规则**:
- 项目类型代码在同一租户内唯一
- 项目类型名称在同一租户内唯一

**数据表**: project_type (新增)

---

### 6.8 基础数据查询

**功能点ID**: BASE-008  
**功能名称**: 基础数据查询  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 各种基础数据的查询接口
- 基础数据缓存
- 基础数据下拉框支持

**主要功能**:
- [ ] 币种列表接口
- [ ] 汇率查询接口（根据日期获取）
- [ ] 报销类型列表接口
- [ ] 费用类型列表接口
- [ ] 城市列表接口（树形）
- [ ] 城市搜索接口
- ] 项目列表接口
- [ ] 项目类型列表接口
- [ ] 补贴标准查询接口
- [ ] 基础数据缓存

**输入**:
- 查询条件

**输出**:
- 基础数据列表

**业务规则**:
- 只返回启用状态的数据
- 基础数据缓存5分钟
- 查询支持分页

**数据表**: currency, exchange_rate, trans_type, expense_item_type, city, allowance

---

## 模块7：报销管理 (15功能点)

### 7.1 报销单创建

**功能点ID**: TRANS-001  
**功能名称**: 报销单创建  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 创建新报销单
- 填写报销单基本信息
- 添加报销明细

**主要功能**:
- [ ] 报销单基本信息录入
- [ ] 报销类型选择
- [ ] 项目选择
- [ ] 报销金额填写
- [ ] 币种选择
- [ ] 汇率自动获取
- [ ] 本币金额自动计算
- [ ] 报销说明填写
- [ ] 附件上传
- [ ] 报销明细添加
- [ ] 保存草稿

**输入**:
- 报销单信息
- 明细信息
- 附件信息

**输出**:
- 报销单ID
- 保存结果

**业务规则**:
- 报销单号自动生成
- 报销单号在同一租户内唯一
- 报销金额必须大于0
- 报销单必须有项目
- 明细金额总和必须等于报销单金额

**数据表**: trans, trans_item, charge_item, trans_attach

---

### 7.2 报销单草稿

**功能点ID**: TRANS-002  
**功能名称**: 报销单草稿  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 保存草稿
- 继续编辑草稿
- 草稿列表查询

**主要功能**:
- [ ] 保存草稿
- [ ] 草稿列表查询
- [ ] 草稿继续编辑
- [ ] 草稿删除
- [ ] 草稿恢复
- [ ] 草稿超时清理

**输入**:
- 报销单信息

**输出**:
- 草稿ID
- 保存结果

**业务规则**:
- 草稿状态保存30天
- 超时草稿自动删除
- 草稿可以多次保存

**数据表**: trans, trans_item, charge_item, trans_attach

---

### 7.3 报销单提交

**功能点ID**: TRANS-003  
**功能名称**: 报销单提交  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 提交报销单审批
- 启动审批流程
- 提交前验证

**主要功能**:
- [ ] 提交前数据验证
- [ ] 明细金额验证
- [ ] 附件完整性验证
- [ ] 启动审批流程
- [ ] 生成流程实例ID
- [ ] 更新报销单状态
- [ ] 发送审批通知

**输入**:
- 报销单ID

**输出**:
- 流程实例ID
- 提交结果

**业务规则**:
- 报销单金额必须大于0
- 明细必须完整
- 至少有一个附件
- 报销单必须在草稿状态

**数据表**: trans, workflow_instance

---

### 7.4 报销单查询

**功能点ID**: TRANS-004  
**功能名称**: 报销单查询  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 报销单列表查询
- 多条件组合查询
- 报销单详情查看

**主要功能**:
- [ ] 我的报销单列表
- [ ] 待我审批的报销单列表
- [ ] 报销单搜索（单号、状态、类型等）
- [ ] 报销单筛选（时间、金额、类型等）
- [ ] 报销单排序
- [ ] 报销单详情查看
- [ ] 报销单导出（Excel/PDF）

**输入**:
- 查询条件
- 筛选条件

**输出**:
- 报销单列表
- 报销单详情

**业务规则**:
- 普通用户只能查看自己的报销单
- 审批人可以查看自己需要审批的报销单
- 系统管理员可以查看所有报销单

**数据表**: trans, trans_item, charge_item, trans_attach

---

### 7.5 报销单编辑

**功能点ID**: TRANS-005  
**功能名称**: 报销单编辑  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 编辑报销单信息
- 调整报销明细
- 添加/删除附件

**主要功能**:
- [ ] 报销单基本信息编辑（草稿状态可编辑）
- [ ] 报销明细编辑
- [ ] 报销明细删除
- [ ] 报销明细排序
- [ ] 费用明细编辑
- [ ] 费用明细删除
- [ ] 附件上传
- [ ] 附件删除
- [ ] 本币金额自动重新计算

**输入**:
- 报销单ID
- 编辑表单

**输出**:
- 编辑结果

**业务规则**:
- 只有草稿状态的报销单可以编辑
- 已提交的报销单不能编辑
- 编辑后重新计算本币金额

**数据表**: trans, trans_item, charge_item, trans_attach

---

### 7.6 报销明细管理

**功能点ID**: TRANS-006  
**功能名称**: 报销明细管理  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 添加报销明细
- 编辑报销明细
- 删除报销明细
- 费用明细管理

**主要功能**:
- [ ] 报销明细添加
- [ ] 报销明细编辑
- [ ] 报销明细删除
- [ ] 报销明细排序
- [ ] 费用明细添加
- [ ] 费用明细编辑
- [ ] 费用明细删除
- [ ] 明细金额汇总

**输入**:
- 明细信息
- 费用信息

**输出**:
- 明细列表
- 汇总金额

**业务规则**:
- 明细金额必须大于0
- 费用类型必选
- 明细金额汇总等于报销单金额

**数据表**: trans_item, charge_item

---

### 7.7 报销附件管理

**功能点ID**: TRANS-007  
**功能名称**: 报销附件管理  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 报销附件上传
- 报销附件下载
- 报销附件删除
- 附件预览

**主要功能**:
- [ ] 附件上传（支持多文件）
- [ ] 附件类型限制（PDF、图片、Office文档）
- [ ] 附件大小限制（单个50MB，总计100MB）
- [ ] 附件列表查看
- [ ] 附件下载
- [ ] 附件删除
- [ ] 附件预览（图片、PDF）
- [ ] 附件重命名

**输入**:
- 报销单ID
- 附件文件

**输出**:
- 附件列表
- 上传结果

**业务规则**:
- 附件上传到MinIO
- 附件元数据存储在数据库
- 附件下载需要权限验证

**数据表**: trans_attach

---

### 7.8 报销单审批

**功能点ID**: TRANS-008  
**功能名称**: 报销单审批  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 审批人查看待审批报销单
- 审批通过
- 审批驳回
- 审批转办
- 审批历史查询

**主要功能**:
- [ ] 待审批报销单列表
- [ ] 报销单详情查看（含流程信息）
- [ ] 审批通过（填写审批意见）
- [ ] 审批驳回（填写驳回原因）
- [ ] 审批转办（选择转办人）
- [ ] 审批加签
- [ ] 审批历史查看
- [ ] 当前节点信息

**输入**:
- 报销单ID
- 审批操作
- 审批意见

**输出**:
- 审批结果
- 流程状态

**业务规则**:
- 审批人只能审批分配给自己的任务
- 驳回需要填写驳回原因
- 转办只能转给有审批权限的人

**数据表**: trans, workflow_task, workflow_approval

---

### 7.9 报销单撤回

**功能点ID**: TRANS-009  
**功能名称**: 报销单撤回  
**优先级**: P1 (重要功能)  
**状态**: 待设计

**功能描述**:
- 申请人撤回报销单
- 撤回前验证
- 撤回通知

**主要功能**:
- [ ] 撤回报销单（草稿或已驳回状态）
- [ ] 撤回前验证（是否已开始审批）
- [ ] 撤回原因填写
- [ ] 终止流程实例
- [ ] 更新报销单状态
- [ ] 发送撤回通知

**输入**:
- 报销单ID
- 撤回原因

**输出**:
- 撤回结果

**业务规则**:
- 只有申请人可以撤回
- 只有草稿或已驳回状态可以撤回
- 审批中的报销单不能撤回

**数据表**: trans, workflow_instance, notification

---

### 7.10 报销单结算

**功能点ID**: TRANS-010  
**功能名称**: 报销单结算  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 财务人员结算报销单
- 调整结算金额
- 记录结算信息
- 发放报销款

**主要功能**:
- [ ] 待结算报销单列表
- [ ] 报销单结算
- [ ] 结算金额调整
- [ ] 结算说明填写
- [ ] 结算人设置
- [ ] 结算日期记录
- [ ] 结算完成通知

**输入**:
- 报销单ID
- 结算信息
- 结算金额

**输出**:
- 结算结果
- 结算信息

**业务规则**:
- 只有已通过审批的报销单可以结算
- 结算金额不能超过报销金额
- 结算完成后不能再次结算

**数据表**: trans, notification

---

### 7.11 报销单作废

**功能点ID**: TRANS-011  
**功能名称**: 报销单作废  
**优先级**: P1 (重要功能)  
**状态**: 待设计

**功能描述**:
- 管理员作废报销单
- 作废原因记录
- 作废通知

**主要功能**:
- [ ] 报销单列表（可作废状态筛选）
- [ ] 报销单作废
- [ ] 作废原因填写
- [ ] 终止流程实例
- [ ] 更新报销单状态
- [ ] 发送作废通知

**输入**:
- 报销单ID
- 作废原因

**输出**:
- 作废结果

**业务规则**:
- 系统管理员可以作废任何报销单
- 作废后的报销单不能恢复
- 已结算的报销单不能作废

**数据表**: trans, audit_log

---

### 7.12 报销统计报表

**功能点ID**: TRANS-012  
**功能名称**: 报销统计报表  
**优先级**: P2 (一般功能)  
**状态**: 待设计

**功能描述**:
- 报销单统计
- 报销趋势分析
- 报销导出

**主要功能**:
- [ ] 报销单数量统计（按日/周/月）
- [ ] 报销金额统计（按日/周/月）
- [ ] 报销类型统计
- [ ] 项目报销统计
- [ ] 部门报销统计
- [ ] 用户报销统计
- [ ] 报销趋势图（折线图）
- [ ] 报销分布图（饼图/柱状图）
- [ ] 报销导出（Excel/PDF）

**输入**:
- 统计时间范围
- 统计维度

**输出**:
- 统计数据
- 图表数据

**业务规则**:
- 统计数据延迟1小时更新
- 支持多维度组合查询

**数据表**: trans, trans_item, charge_item

---

### 7.13 报销单打印

**功能点ID**: TRANS-013  
**功能名称**: 报销单打印  
**优先级**: P2 (一般功能)  
**状态**: 待设计

**功能描述**:
- 报销单打印预览
- 报销单打印
- 报销单PDF导出

**主要功能**:
- [ ] 报销单打印预览
- [ ] 报销单打印（A4纸张）
- [ ] 报销单PDF导出
- [ ] 报销单自定义打印模板
- [ ] 打印设置（页眉、页脚、水印）

**输入**:
- 报销单ID
- 打印模板

**输出**:
- PDF文件

**业务规则**:
- 只有已结算的报销单可以打印
- 打印操作需要审计日志

**数据表**: trans, trans_item

---

### 7.14 报销单复制

**功能点ID**: TRANS-014  
**功能名称**: 报销单复制  
**优先级**: P2 (一般功能)  
**状态**: 待设计

**功能描述**:
- 复制已有报销单
- 批量复制报销单

**主要功能**:
- [ ] 选择报销单复制
- [ ] 批量复制报销单
- [ ] 生成新报销单号
- [ ] 复制报销明细
- [ ] 复制附件（需要重新上传）

**输入**:
- 报销单ID列表

**输出**:
- 新报销单ID

**业务规则**:
- 复制的报销单初始为草稿状态
- 附件需要重新上传

**数据表**: trans, trans_item, charge_item, trans_attach

---

### 7.15 报销单关联查询

**功能点ID**: TRANS-015  
**功能名称**: 报销单关联查询  
**优先级**: P2 (一般功能）  
**状态**: 待设计

**功能描述**:
- 查询用户报销历史
- 查询项目报销列表
- 查询组织报销统计

**主要功能**:
- [ ] 用户报销历史
- [ ] 项目报销列表
- [ ] 部门报销统计
- [ ] 组织报销统计
- [ ] 报销类型统计
- [ ] 关联数据导出

**输入**:
- 用户ID/项目ID/组织ID

**输出**:
- 报销列表
- 统计数据

**业务规则**:
- 普通用户只能查询自己的数据
- 根据权限查询关联数据

**数据表**: trans, trans_item, charge_item, user, project, org

---

## 模块8：借款管理 (8功能点)

### 8.1 借款单创建

**功能点ID**: LOAN-001  
**功能名称**: 借款单创建  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 创建新借款单
- 填写借款基本信息
- 借款额度校验

**主要功能**:
- [ ] 借款单基本信息录入
- [ ] 借款类型选择
- [ ] 项目选择
- [ ] 借款金额填写
- [ ] 借款期限设置
- [ ] 还款日期计算
- [ ] 借款说明填写
- [ ] 借款额度校验
- [ ] 附件上传
- [ ] 保存草稿

**输入**:
- 借款单信息
- 附件信息

**输出**:
- 借款单ID
- 保存结果

**业务规则**:
- 借款单号自动生成
- 借款单号在同一租户内唯一
- 借款金额必须大于0
- 借款金额不能超过剩余额度
- 借款必须有项目

**数据表**: loan, loan_attach

---

### 8.2 借款单草稿

**功能点ID**: LOAN-002  
**功能名称**: 借款单草稿  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 保存草稿
- 继续编辑草稿
- 草稿列表查询

**主要功能**:
- [ ] 保存草稿
- [ ] 草稿列表查询
- [ ] 草稿继续编辑
- [ ] 草稿删除
- [ ] 草稿恢复
- [ ] 草稿超时清理

**输入**:
- 借款单信息

**输出**:
- 草稿ID
- 保存结果

**业务规则**:
- 草稿状态保存30天
- 超时草稿自动删除

**数据表**: loan, loan_attach

---

### 8.3 借款单提交

**功能点ID**: LOAN-003  
**功能名称**: 借款单提交  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 提交借款单审批
- 启动审批流程
- 提交前验证

**主要功能**:
- [ ] 提交前数据验证
- [ ] 借款额度验证
- [ ] 附件完整性验证
- [ ] 启动审批流程
- [ ] 生成流程实例ID
- [ ] 更新借款单状态
- [ ] 发送审批通知

**输入**:
- 借款单ID

**输出**:
- 流程实例ID
- 提交结果

**业务规则**:
- 借款金额必须大于0
- 借款金额不能超过剩余额度
- 借款单必须有项目
- 至少有一个附件

**数据表**: loan, workflow_instance

---

### 8.4 借款单查询

**功能点ID**: LOAN-004  
**功能名称**: 借款单查询  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 借款单列表查询
- 多条件组合查询
- 借款单详情查看

**主要功能**:
- [ ] 我的借款单列表
- [ ] 待我审批的借款单列表
- [ ] 借款单搜索
- [ ] 借款单筛选
- [ ] 借款单排序
- [ ] 借款单详情查看
- [ ] 借款单导出

**输入**:
- 查询条件
- 筛选条件

**输出**:
- 借款单列表
- 借款单详情

**业务规则**:
- 普通用户只能查看自己的借款单
- 审批人可以查看自己需要审批的借款单
- 系统管理员可以查看所有借款单

**数据表**: loan, loan_attach

---

### 8.5 借款单审批

**功能点ID**: LOAN-005  
**功能名称**: 借款单审批  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 审批人查看待审批借款单
- 审批通过
- 审批驳回
- 审批转办
- 审批历史查询

**主要功能**:
- [ ] 待审批借款单列表
- [ ] 借款单详情查看
- [ ] 审批通过
- [ ] 审批驳回
- [ ] 审批转办
- [ ] 审批加签
- [ ] 审批历史查看

**输入**:
- 借款单ID
- 审批操作
- 审批意见

**输出**:
- 审批结果
- 流程状态

**业务规则**:
- 审批人只能审批分配给自己的任务
- 驳回需要填写驳回原因
- 转办只能转给有审批权限的人

**数据表**: loan, workflow_task, workflow_approval

---

### 8.6 借款单发放

**功能ID**: LOAN-006  
**功能名称**: 借款单发放  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 财务人员发放借款
- 记录发放信息
- 发放通知

**主要功能**:
- [ ] 待发放借款单列表
- [ ] 借款单发放
- [ ] 发放金额确认
- [ ] 发放方式选择（银行转账/现金）
- [ ] 发放时间记录
- [ ] 发放说明填写
- [ ] 发送发放通知

**输入**:
- 借款单ID
- 发放信息
- 发放金额

**输出**:
- 发放结果
- 发放信息

**业务规则**:
- 只有已通过审批的借款单可以发放
- 发放金额必须等于借款金额
- 发放完成后不能再次发放

**数据表**: loan, notification

---

### 8.7 借款还款跟踪

**功能点ID**: LOAN-007  
**功能名称**: 借款还款跟踪  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 查询借款还款情况
- 计算未还金额
- 还款逾期提醒

**主要功能**:
- [ ] 借款还款列表
- [ ] 未还金额计算
- [ ] 逾期天数计算
- [ ] 逾期标识
- [ ] 还款进度显示
- [ ] 逾期提醒通知
- [ ] 借款还款报表

**输入**:
- 借款ID

**输出**:
- 还款列表
- 还款进度

**业务规则**:
- 逾期标识（超过到期日期）
- 未还金额 = 借款金额 - 已还金额

**数据表**: loan, repayment, repayment_sett

---

### 8.8 借款统计报表

**功能点ID**: LOAN-008  
**功能名称**: 借款统计报表  
**优先级**: P2 (一般功能)  
**状态**: 待设计

**功能描述**:
- 借款单统计
- 借款趋势分析
- 借款导出

**主要功能**:
- [ ] 借款单数量统计
- [ ] 借款金额统计
- [ ] 借款类型统计
- [ ] 项目借款统计
- [ ] 借款状态统计
- [ ] 逾期借款统计
- [ ] 借款趋势图
- [ ] 借款导出

**输入**:
- 统计时间范围
- 统计维度

**输出**:
- 统计数据
- 图表数据

**业务规则**:
- 统计数据延迟1小时更新

**数据表**: loan, repayment

---

## 模块9：还款管理 (7功能点)

### 9.1 还款单创建

**功能点ID**: REPAY-001  
**功能名称**: 还款单创建  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 创建新还款单
- 关联借款单
- 选择冲销借款

**主要功能**:
- [ ] 还款单基本信息录入
- [ ] 选择还款方式（冲销借款）
- [ ] 借款列表查询（可还款的借款）
- [ ] 选择要冲销的借款
- [ ] 冲销金额分配
- [ ] 还款说明填写
- [ ] 附件上传
- [ ] 保存草稿

**输入**:
- 还款单信息
- 借款ID列表
- 冲销金额

**输出**:
- 还款单ID
- 保存结果

**业务规则**:
- 还款单号自动生成
- 还款单号在同一租户内唯一
- 还款金额必须大于0
- 还款金额必须小于等于借款未还金额
- 还款必须关联到借款

**数据表**: repayment, repayment_sett, repayment_attach

---

### 9.2 还款单草稿

**功能点ID**: REPAY-002  
**功能名称**: 还款单草稿  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 保存草稿
- 继续编辑草稿
- 草稿列表查询

**主要功能**:
- [ ] 保存草稿
- [ ] 草稿列表查询
- [ ] 草稿继续编辑
- [ ] 草稿删除
- [ ] 草稿恢复
- [ ] 草稿超时清理

**输入**:
- 还款单信息

**输出**:
- 草稿ID
- 保存结果

**业务规则**:
- 草稿状态保存30天
- 超时草稿自动删除

**数据表**: repayment, repayment_sett, repayment_attach

---

### 9.3 还款单提交

**功能点ID**: REPAY-003  
**功能名称**: 还款单提交  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 提交还款单审批
- 启动审批流程
- 提交前验证

**主要功能**:
- [ ] 提交前数据验证
- [ ] 冲销金额验证
- [ ] 附件完整性验证
- [ ] 启动审批流程
- [ ] 生成流程实例ID
- [ ] 更新还款单状态
- [ ] 发送审批通知

**输入**:
- 还款单ID

**输出**:
- 流程实例ID
- 提交结果

**业务规则**:
- 还款金额必须大于0
- 冲销金额必须小于等于所选借款的未还金额
- 还款单必须有项目
- 至少有一个附件

**数据表**: repayment, repayment_sett, workflow_instance

---

### 9.4 还款单查询

**功能点ID**: REPAY-004  
**功能名称**: 还款单查询  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 还款单列表查询
- 多条件组合查询
- 还款单详情查看

**主要功能**:
- [ ] 我的还款单列表
- [ ] 待我审批的还款单列表
- [ ] 还款单搜索
- [ ] 还款单筛选
- [ ] 还款单排序
- [ ] 还款单详情查看
- [ ] 还款单导出

**输入**:
- 查询条件
- 筛选条件

**输出**:
- 还款单列表
- 还款单详情

**业务规则**:
- 普通用户只能查看自己的还款单
- 审批人可以查看自己需要审批的还款单
- 系统管理员可以查看所有还款单

**数据表**: repayment, repayment_sett, repayment_attach

---

### 9.5 还款单审批

**功能点ID**: REPAY-005  
**功能名称**: 还款单审批  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 审批人查看待审批还款单
- 审批通过
- 审批驳回
- 审批转办
- 审批历史查询

**主要功能**:
- [ ] 待审批还款单列表
- [ ] 还款单详情查看
- [ ] 审批通过
- [ ] 审批驳回
- [ ] 审批转办
- [ ] 审批加签
- [ ] 审批历史查看

**输入**:
- 还款单ID
- 审批操作
- 审批意见

**输出**:
- 审批结果
- 流程状态

**业务规则**:
- 审批人只能审批分配给自己的任务
- 驳回需要填写驳回原因
- 转办只能转给有审批权限的人

**数据表**: repayment, workflow_task, workflow_approval

---

### 9.6 还款单结算

**功能ID**: REPAY-006  
**功能名称**: 还款单结算  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 财务人员结算还款单
- 记录冲销信息
- 更新借款余额

**主要功能**:
- [ ] 待结算还款单列表
- [ ] 还款单结算
- [ ] 冲销金额确认
- [ ] 冲销信息记录
- [ ] 结算日期记录
- [ ] 更新借款未还金额
- [ ] 发送结算完成通知

**输入**:
- 还款单ID
- 结算信息

**输出**:
- 结算结果
- 冲销信息

**业务规则**:
- 只有已通过审批的还款单可以结算
- 结算后自动更新借款未还金额
- 结算完成后不能再次结算

**数据表**: repayment, repayment_sett, loan, notification

---

### 9.7 还款统计报表

**功能点ID**: REPAY-007  
**功能名称**: 还款统计报表  
**优先级**: P2 (一般功能)  
**状态**: 待设计

**功能描述**:
- 还款单统计
- 还款趋势分析
- 还款导出

**主要功能**:
- [ ] 还款单数量统计
- [ ] 还款金额统计
- [ ] 还款类型统计
- [ ] 项目还款统计
- [ ] 还款方式统计
- [ ] 还款状态统计
- [ ] 还款趋势图
- [ ] 还款导出

**输入**:
- 统计时间范围
- 统计维度

**输出**:
- 统计数据
- 图表数据

**业务规则**:
- 统计数据延迟1小时更新

**数据表**: repayment, repayment_sett, loan

---

## 模块10：工作流管理 (6功能点)

### 10.1 流程定义管理

**功能点ID**: WF-001  
**功能名称**: 流程定义管理  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 创建流程定义
- 编辑流程定义
- 部署流程定义

**主要功能**:
- [ ] 流程定义列表
- [ ] 流程定义创建
- [ ] 流程定义编辑（JSON格式）
- [ ] 流程定义部署
- [ ] 流程定义启用/禁用
- [ ] 流程定义版本管理
- [ ] 流程定义导入/导出
- [ ] 流程定义可视化设计器

**输入**:
- 流程定义JSON
- 流程文件（BPMN）

**输出**:
- 流程定义ID
- 部署结果

**业务规则**:
- 流程定义key在同一租户内唯一
- 流程定义启用后不能编辑

**数据表**: workflow_definition (Flowable act_re_procdef, act_re_deployment)

---

### 10.2 流程实例查询

**功能点ID**: WF-002  
**功能名称**: 流程实例查询  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 查询流程实例
- 流程实例详情查看
- 流程历史查询

**主要功能**:
- [ ] 流程实例列表查询
- [ ] 流程实例详情查看
- [ ] 流程实例状态查看
- [ ] 流程变量查看
- [ ] 流程实例终止
- [ ] 流程实例删除
- [ ] 流程实例统计

**输入**:
- 查询条件

**输出**:
- 流程实例列表
- 流程实例详情

**业务规则**:
- 流程实例按租户隔离

**数据表**: workflow_instance

---

### 10.3 任务管理

**功能点ID**: WF-003  
**功能名称**: 任务管理  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 待办任务查询
- 任务详情查看
- 任务认领
- 任务完成
- 任务转办

**主要功能**:
- [ ] 待办任务列表
- [ ] 待办任务详情
- [ ] 任务认领
- [ ] 任务完成
- [ ] 任务转办
- [ ] 任务加签
- [ ] 任务委托
- [ ] 任务退回
- [ ] 任务统计

**输入**:
- 任务ID
- 操作类型

**输出**:
- 任务列表
- 操作结果

**业务规则**:
- 任务只能被有权限的用户认领
- 任务认领后只能由认领人完成

**数据表**: workflow_task

---

### 10.4 审批历史查询

**功能点ID**: WF-004  
**功能名称**: 审批历史查询  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 查询审批历史
- 审批历史详情
- 审批流程可视化

**主要功能**:
- [ ] 审批历史列表
- [ ] 审批历史详情
- [ ] 审批流程图展示
- [ ] 审批时间线展示
- [ ] 审批意见查看
- [ ] 审批附件查看

**输入**:
- 业务ID
- 流程实例ID

**输出**:
- 审批历史

**业务规则**:
- 审批历史按时间倒序

**数据表**: workflow_approval

---

### 10.5 流程监控

**功能点ID**: WF-005  
**功能名称**: 流程监控  
**优先级**: P2 (一般功能)  
**状态**: 待设计

**功能描述**:
- 流程实例监控
- 任务监控
- 异常流程处理

**主要功能**:
- [ ] 流程实例列表
- [ ] 流程实例状态监控
- [ ] 异常流程标识
- [ ] 流程实例终止
- [ ] 流程实例重启
- [ ] 任务超时监控
- [ ] 任务统计报表

**输入**:
- 监控条件

**输出**:
- 监控数据
- 异常列表

**业务规则**:
- 超过24小时未处理的任务标识为异常

**数据表**: workflow_instance, workflow_task

---

### 10.6 流程设计器

**功能点ID**: WF-006  
**功能名称**: 流程设计器  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 可视化流程设计
- 流程节点拖拽
- 流程连线
- 流程验证

**主要功能**:
- [ ] 流程设计画布
- [ ] 流程节点拖拽
- [ ] 流程连线配置
- [ ] 网关配置
- [ ] 任务节点配置
- [ ] 审批人配置
- [ ] 流程变量配置
- [ ] 流程验证
- [ ] 流程预览
- [ ] 流程导入/导出

**输入**:
- 流程定义

**输出**:
- 流程定义JSON
- 验证结果

**业务规则**:
- 流程必须有开始节点和结束节点
- 流程不能有孤立节点

**数据表**: workflow_definition

---

## 模块11：通知管理 (5功能点)

### 11.1 通知发送

**功能点ID**: NOTIF-001  
**功能名称**: 通知发送  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 发送系统通知
- 发送审批通知
- 发送提醒通知
- 批量发送通知

**主要功能**:
- [ ] 发送系统通知
- [ ] 发送审批通知
- [ ] 发送驳回通知
- [ ] 发送完成通知
- [ ] 发送提醒通知
- [ ] 批量发送通知
- [ ] 通知发送记录

**输入**:
- 通知类型
- 接收人ID列表
- 通知内容
- 通知渠道（系统内/钉钉/邮件/短信）

**输出**:
- 发送结果

**业务规则**:
- 通知内容不能为空
- 接收人必须在同一租户内
- 发送失败需要重试3次

**数据表**: notification

---

### 11.2 通知查询

**功能点ID**: NOTIF-002  
**功能名称**: 通知查询  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 我的通知列表
- 通知详情查看
- 通知已读/未读状态

**主要功能**:
- [ ] 我的通知列表
- [ ] 未读通知数量统计
- [ ] 通知筛选（全部/系统/审批/提醒）
- [ ] 通知详情查看
- [ ] 标记已读
- [ ] 批量标已读
- [ ] 删除通知
- [ ] 通知搜索

**输入**:
- 查询条件

**输出**:
- 通知列表

**业务规则**:
- 只查询当前用户的通知
- 已删除通知不在查询范围

**数据表**: notification

---

### 11.3 通知设置

**功能ID**: NOTIF-003  
**功能名称**: 通知设置  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 用户通知偏好设置
- 通知渠道开关
- 通知时间设置

**主要功能**:
- [ ] 通知渠道开关（系统内/钉钉/邮件/短信）
- [ ] 通知类型偏好（全部/重要/不接收）
- [ ] 通知时间设置
- [ ] 免打扰时间段设置

**输入**:
- 通知设置

**输出**:
- 设置结果

**业务规则**:
- 免打扰时间段内不发送非紧急通知

**数据表**: user, notification

---

### 11.4 钉钉通知

**功能点ID**: NOTIF-004  
**功能名称**: 钉钉通知  
**优先级**: P1 (重要功能）  
**状态**: 待设计

**功能描述**:
- 钉钉消息发送
- 钉钉消息模板
- 钉钉消息历史

**主要功能**:
- [ ] 钉钉通知发送
- [ ] 钉钉消息模板管理
- [ ] 钉钉消息历史查询
- [ ] 钉钉通知失败重试
- [ ] 钉钉通知统计

**输入**:
- 钉钉用户ID
- 消息内容
- 消息类型

**输出**:
- 发送结果

**业务规则**:
- 钉钉消息长度限制
- 钉钉消息频率限制

**数据表**: notification

---

### 11.5 通知模板管理

**功能点ID**: NOTIF-005  
**功能名称**: 通知模板管理  
**优先级**: P2 (一般功能)  
**状态**: 待设计

**功能描述**:
- 通知模板创建
- 通知模板编辑
- 通知模板变量

**主要功能**:
- [ ] 通知模板列表
- [ ] 通知模板创建
- [ ] 通知模板编辑
- [ ] 通知模板启用/禁用
- [ ] 模板变量配置
- [ ] 模板预览
- [ ] 模板导入/导出

**输入**:
- 模板信息
- 变量数据

**输出**:
- 生成内容

**业务规则**:
- 模板使用${variable}语法

**数据表**: notification_template (新增)

---

## 模块12：审计日志 (5功能点)

### 12.1 操作日志记录

**功能点ID**: AUDIT-001  
**功能名称**: 操作日志记录  
**优先级**: P0 (核心功能）  
**状态**: 待设计

**功能描述**:
- 自动记录所有操作
- 记录操作详情
- 记录操作结果

**主要功能**:
- [ ] 自动记录增删改操作
- [ ] 记录操作人信息
- [ ] 记录操作时间
- [ ] 记录操作类型
- [ ] 记录操作前数据
- [ ] 记录操作后数据
- [ ] 记录请求信息

**输入**:
- 操作事件

**输出**:
- 日志ID

**业务规则**:
- 所有写操作必须记录日志
- 读取操作可选择是否记录

**数据表**: audit_log

---

### 12.2 操作日志查询

**功能点ID**: AUDIT-002  
**功能名称**: 操作日志查询  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 操作日志列表查询
- 多条件筛选
- 操作日志详情查看

**主要功能**:
- [ ] 操作日志列表查询
- [ ] 操作人筛选
- [ ] 操作模块筛选
- [ ] 操作类型筛选
- [ ] 操作时间筛选
- [ ] 操作结果筛选
- [ ] 操作日志详情查看
- [ ] 操作日志导出

**输入**:
- 查询条件

**输出**:
- 操作日志列表

**业务规则**:
- 只能查询本租户的操作日志
- 系统管理员可以查询所有租户的日志

**数据表**: audit_log

---

### 12.3 操作日志统计

**功能点ID**: AUDIT-003  
**功能名称**: 操作日志统计  
**优先级**: P2 (一般功能)  
**状态**: 待设计

**功能描述**:
- 操作统计报表
- 操作趋势分析
- 操作热力图

**主要功能**:
- [ ] 操作次数统计（按人/模块/类型）
- [ ] 操作时间分布统计
- [ ] 操作成功率统计
- [ ] 用户操作频率排名
- [ ] 操作热力图
- [ ] 操作日志导出

**输入**:
- 统计维度

**输出**:
- 统计数据
- 图表数据

**业务规则**:
- 统计数据延迟1小时更新

**数据表**: audit_log

---

### 12.4 登录日志

**功能点ID**: AUDIT-004  
**功能名称**: 登录日志  
**优先级**: P0 (核心功能)  
**状态**: 待设计

**功能描述**:
- 记录用户登录
- 记录登录失败
- 记录登出

**主要功能**:
- [ ] 登录成功记录
- [ ] 登录失败记录
- [ ] 登出记录
- [ ] 登录IP记录
- [ ] 登录设备记录
- [ ] 登录位置记录
- [ ] 异常登录监控

**输入**:
- 登录事件

**输出**:
- 日志ID

**业务规则**:
- 记录所有登录尝试
- 登录失败超过5次锁定账户

**数据表**: login_log (新增)

---

### 12.5 数据变更追踪

**功能点ID**: AUDIT-005  
**功能名称**: 数据变更追踪  
**优先级**: P1 (重要功能)  
**状态**: 待设计

**功能描述**:
- 追踪数据变更历史
- 对比数据变更
- 数据回滚

**主要功能**:
- [ ] 数据变更历史查询
- [ ] 数据版本对比
- [ ] 数据差异高亮
- [ ] 数据回滚
- [ ] 变更人信息

**输入**:
- 表名
- 主键ID

**输出**:
- 变更历史

**业务规则**:
- 数据回滚需要管理员权限
- 回滚后记录审计日志

**数据表**: data_change_log (新增)

---

## 模块13：表单管理 (6功能点)

### 13.1 表单配置管理

**功能点ID**: FORM-001  
**功能名称**: 表单配置管理  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 创建表单配置
- 编辑表单配置
- 表单配置版本管理

**主要功能**:
- [ ] 表单配置列表
- [ ] 表单配置创建（JSON格式）
- [ ] 表单配置编辑
- [ ] 表单配置版本管理
- [ ] 表单配置启用/禁用
- [ ] 表单配置预览
- [ ] 表单配置导入/导出

**输入**:
- 表单配置JSON

**输出**:
- 表单配置ID

**业务规则**:
- 表单key在同一租户内唯一
- 表单配置版本按数字递增

**数据表**: form_definition (新增)

---

### 13.2 表单字段配置

**功能点ID**: FORM-002  
**功能名称**: 表单字段配置  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 表单字段定义
- 字段类型管理
- 字段验证规则

**主要功能**:
- [ ] 表单字段列表
- [ ] 字段类型选择（文本/数字/下拉等）
- [ ] 字段属性配置
- [ ] 字段验证规则配置
- [ ] 字段默认值设置
- [ ] 字段显示/隐藏
- [ ] 字段排序调整

**输入**:
- 字段配置

**输出**:
- 字段配置

**业务规则**:
- 字段ID在同一表单内唯一
- 必填字段必须有验证规则

**数据表**: form_field_definition (新增)

---

### 13.3 表单验证规则

**功能点ID**: FORM-003  
**功能名称**: 表单验证规则  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 表单级验证规则
- 字段间验证规则
- 自定义验证规则

**主要功能**:
- [ ] 验证规则列表
- [ ] 验证规则创建
- [ ] 验证规则编辑
- [ ] 验证规则启用/禁用
- [ ] 验证规则测试
- [ ] 验证规则类型（正则/自定义表达式）

**输入**:
- 验证规则

**输出**:
- 验证结果

**业务规则**:
- 验证规则支持EL表达式

**数据表**: form_validation_rule (新增)

---

### 13.4 表单动作配置

**功能ID**: FORM-004  
**功能名称**: 表单动作配置  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 表单按钮配置
- 表单提交动作
- 表单API调用

**主要功能**:
- [ ] 表单动作列表
- [ ] 动作类型选择（提交/保存草稿）
- [ ] 按钮样式配置
- [ ] 按钮确认配置
- [ ] API调用配置
- [ ] 动作脚本配置

**输入**:
- 动作配置

**输出**:
- 动作配置

**业务规则**:
- 表单必须至少有一个提交动作

**数据表**: form_action (新增)

---

### 13.5 表单数据规则

**功能点ID**: FORM-005  
**功能名称**: 表单数据规则  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 表单字段联动规则
- 表单字段计算规则
- 表单数据来源

**主要功能**:
- [ ] 数据联动规则配置
- [ ] 字段计算规则配置
- [ ] 数据源配置（API/静态）
- [ ] 规则优先级

**输入**:
- 规则配置

**输出**:
- 规则结果

**业务规则**:
- 数据规则支持EL表达式

**数据表**: form_data_rule (新增)

---

### 13.6 动态表单渲染

**功能点ID**: FORM-006  
**功能名称**: 动态表单渲染  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 根据配置动态渲染表单
- 表单字段动态加载
- 表单验证动态执行

**主要功能**:
- [ ] 动态表单渲染
- [ ] 表单字段动态渲染
- [ ] 表单验证动态执行
- [ ] 表单数据联动更新
- [ ] 表单错误提示
- [ ] 表单提交

**输入**:
- 表单配置key
- 表单初始数据

**输出**:
- 渲染后的表单
- 表单数据

**业务规则**:
- 根据权限动态显示字段
- 隐藏字段不参与验证

**数据表**: form_definition, form_field_definition, form_validation_rule

---

## 模块14：插件管理 (6功能点)

### 14.1 插件注册

**功能点ID**: PLUGIN-001  
**功能名称**: 插件注册  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 插件信息注册
- 插件依赖配置
- 插件权限配置

**主要功能**:
- [ ] 插件列表
- [ ] 插件注册
- [ ] 插件信息编辑
- [ ] 插件依赖配置
- [ ] 插件权限配置
- [ ] 插件启用/禁用
- [ ] 插件版本管理

**输入**:
- 插件信息

**输出**:
- 插件ID

**业务规则**:
- 插件代码必须唯一
- 插件依赖必须已注册

**数据表**: plugin_registry (新增)

---

### 14.2 插件加载

**功能点ID**: PLUGIN-002  
**功能名称**: 插件加载  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 插件自动加载
- 插件手动加载
- 插件热加载
- 插件卸载

**主要功能**:
- [ ] 插件自动加载
- [ ] 插件手动加载
- [ ] 插件状态查询
- [ ] 插件热加载
- [ ] 插件卸载
- [ ] 插件错误处理
- [ ] 插件日志

**输入**:
- 插件ID

**输出**:
- 加载结果

**业务规则**:
- 依赖插件必须先加载
- 卸载插件前检查依赖

**数据表**: plugin_registry

---

### 14.3 插件配置

**功能点ID**: PLUGIN-003  
**功能名称**: 插件配置  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 插件配置管理
- 插件参数配置
- 插件配置更新

**主要功能**:
- [ ] 插件配置列表
- [ ] 插件参数配置
- [ ] 插件配置编辑
- [ ] 插件配置版本管理
- [ ] 插件配置导入/导出

**输入**:
- 插件ID
- 配置数据

**输出**:
- 配置结果

**业务规则**:
- 插件配置为JSON格式

**数据表**: plugin_config (新增)

---

### 14.4 插件状态管理

**功能点ID**: PLUGIN-004  
**功能名称**: 插件状态管理  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 插件状态查询
- 插件状态监控
- 插件异常处理

**主要功能**:
- [ ] 插件状态列表
- [ ] 插件状态查询
- [ ] 插件健康状态监控
- [ ] 插件异常预警
- [ ] 插件重启
- [ ] 插件禁用

**输入**:
- 插件ID

**输出**:
- 插件状态

**业务规则**:
- 异常插件自动禁用

**数据表**: plugin_registry

---

### 14.5 插件依赖管理

**功能点ID**: PLUGIN-005  
**功能名称**: 插件依赖管理  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 查看插件依赖关系
- 插件依赖图
- 依赖冲突检测

**主要功能**:
- [ ] 插件依赖树展示
- [ ] 依赖关系查询
- [ ] 依赖冲突检测
- [ ] 依赖版本检查
- [ ] 循环依赖检测

**输入**:
- 插件ID

**输出**:
- 依赖树
- 冲突报告

**业务规则**:
- 循环依赖的插件不能加载

**数据表**: plugin_registry

---

### 14.6 插件市场

**功能点ID**: PLUGIN-006  
**功能名称**: 插件市场  
**优先级**: P3 (扩展功能)  
**状态**: 待设计

**功能描述**:
- 插件市场展示
- 插件安装
- 插件评价
- 插件反馈

**主要功能**:
- [ ] 插件市场展示
- [ ] 插件分类展示
- [ ] 插件详情查看
- [ ] 插件安装
- [ ] 插件评分
- [ ] 插件评论
- [ ] 插件统计（安装量/评分）

**输入**:
- 插件ID

**输出**:
- 安装结果

**业务规则**:
- 插件市场为公共功能
- 插件需要审核才能上架

**数据表**: plugin_market (新增)

---

## 模块15：API管理 (5功能点)

### 15.1 API注册

**功能点ID**: API-001  
**功能名称**: API注册  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- 注册自定义API
- API信息配置
- API权限配置

**主要功能**:
- [ ] 自定义API列表
- [ ] API注册（注解方式）
- [ ] API信息配置
- [ ] API权限配置
- [ ] API版本管理
- [ ] API分组管理
- [ ] API文档自动生成

**输入**:
- API注解

**输出**:
- API ID

**业务规则**:
- API路径全局唯一
- API必须有权限要求

**数据表**: api_registry (新增)

---

### 15.2 API扩展点

**功能点ID**: API-002  
**功能名称**: API扩展点  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- API钩子注册
- Before/After钩子
- 数据转换器注册

**主要功能**:
- [ ] Before钩子列表
- [ ] After钩子列表
- [ ] 钩子注册
- [ ] 数据转换器注册
- [ ] 钩子优先级
- [ ] 钩子测试

**输入**:
- 钩子配置

**输出**:
- 钩子ID

**业务规则**:
- 钩子必须有优先级
- 钩子按优先级顺序执行

**数据表**: api_hook (新增)

---

### 15.3 API版本管理

**功能点ID**: API-003  
**功能名称**: API版本管理  
**优先级**: P1 (插件化功能)  
**状态**: 待设计

**功能描述**:
- API版本管理
- API版本切换
- API版本回退

**主要功能**:
- [ ] API版本列表
- [ ] API版本创建
- [ ] API版本切换
- [ ] API版本弃用
- [ ] API版本回退
- [ ] API版本统计

**输入**:
- API版本信息

**输出**:
- 版本信息

**业务规则**:
- 同一API同时只能有一个活跃版本

**数据表**: api_version (新增)

---

### 15.4 API调用日志

**功能点ID**: API-004  
**功能名称**: API调用日志  
**优先级**: P2 (一般功能)  
**状态**: 待设计

**功能描述**:
- 记录API调用
- API调用统计
- API错误日志

**主要功能**:
- [ ] API调用记录
- [ ] API调用列表查询
- [ ] API错误记录
- [ ] API调用统计（按API/用户/状态）
- [ ] API响应时间统计
- - API错误率统计

**输入**:
- API调用事件

**输出**:
- 日志ID

**业务规则**:
- 记录所有API调用
- API错误记录需要包含堆栈

**数据表**: api_call_log (新增)

---

### 15.5 API测试工具

**功能点ID**: API-005  
**功能名称**: API测试工具  
**优先级**: P3 (扩展功能)  
**状态**: 待设计

**功能描述**:
- API在线测试
- API调试
- API文档集成

**主要功能**:
- [ ] API列表
- [ ] API调试界面
- [ ] API参数输入
- [ ] API请求发送
- [ ] API响应展示
- [ ] API历史记录
- [ ] 导出Postman/Insomnia格式

**输入**:
- API信息
- 请求参数

**输出**:
- API响应

**业务规则**:
- 支持所有HTTP方法

**数据表**: api_call_log

---

## 功能点优先级说明

- **P0**: 核心功能，必须实现，阻塞其他功能
- **P1**: 重要功能，建议实现，影响用户体验
- **P2**: 一般功能，可以后续迭代
- **P3**: 扩展功能，按需实现

---

## 实施顺序建议

### 第一阶段（4周，核心功能）
1. 租户管理 (4功能点)
2. 用户管理 (8功能点)
3. 组织管理 (6功能点)
4. 角色权限管理 (10功能点)
5. 项目管理 (6功能点)

### 第二阶段（3周，业务功能）
1. 基础数据管理 (8功能点)
2. 报销管理 (15功能点)

### 第三阶段（3周，业务功能）
1. 借款管理 (8功能点)
2. 还款管理 (7功能点)

### 第四阶段（2周，工作流）
1. 工作流管理 (6功能点)

### 第五阶段（2周，通知审计）
1. 通知管理 (5功能点)
2. 审计日志 (5功能点)

### 第六阶段（3周，插件化）
1. 表单管理 (6功能点)
2. 插件管理 (6功能点)
3. API管理 (5功能点)

**总计**: 122个功能点，预计19周完成

---

**文档版本**: v1.0  
**创建日期**: 2026-01-24  
**状态**: 功能点清单，待逐个进行详细设计
