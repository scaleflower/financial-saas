# è´¢åŠ¡æŠ¥é”€ç³»ç»Ÿ - æ’ä»¶åŒ–æ¶æ„é‡æ„æ–¹æ¡ˆ

## ğŸ¯ é‡æ„ç›®æ ‡

### æ ¸å¿ƒé—®é¢˜è¯Šæ–­

#### 1. å·¥ä½œæµå®¡æ‰¹ç³»ç»Ÿé—®é¢˜ï¼ˆä¸¥é‡åº¦ï¼šé«˜ï¼‰

**é—®é¢˜1: BPMNæµç¨‹ç¡¬ç¼–ç ï¼Œæ— æ³•çµæ´»è°ƒæ•´**
```xml
<!-- âŒ é—®é¢˜ï¼šé‡‘é¢é˜ˆå€¼ç¡¬ç¼–ç åœ¨BPMN XMLä¸­ -->
<sequenceFlow id="flow4a" sourceRef="amountGateway" targetRef="ceoApproval">
  <conditionExpression xsi:type="tFormalExpression">
    <![CDATA[${amount > 10000}]]>  <!-- ç¡¬ç¼–ç é˜ˆå€¼ -->
  </conditionExpression>
</sequenceFlow>
```
**å½±å“**ï¼šä¿®æ”¹é˜ˆå€¼éœ€è¦ä¿®æ”¹BPMNæ–‡ä»¶ï¼ŒéæŠ€æœ¯äººå‘˜æ— æ³•æ“ä½œ

**é—®é¢˜2: ä¸šåŠ¡é€»è¾‘ä¸æµç¨‹é€»è¾‘è€¦åˆä¸¥é‡**
```java
// FlowableWorkflowServiceåªæ˜¯ç®€å•APIå°è£…
public void completeTask(String taskId, String comment, Map<String, Object> variables) {
    // âŒ æ²¡æœ‰ä¸šåŠ¡çŠ¶æ€åŒæ­¥é€»è¾‘
    // âŒ æ²¡æœ‰ä¸šåŠ¡è§„åˆ™æ ¡éªŒ
    // âŒ æ²¡æœ‰é€šçŸ¥æœºåˆ¶
    taskService.complete(taskId, variables);
}
```
**å½±å“**ï¼šå®¡æ‰¹åä¸šåŠ¡çŠ¶æ€ä¸åŒæ­¥ï¼Œæ•°æ®ä¸ä¸€è‡´

**é—®é¢˜3: ä»»åŠ¡ç›‘å¬å™¨åŠŸèƒ½è¿‡å¼±**
```java
@Component("taskAssignmentListener")
public class TaskAssignmentListener implements TaskListener {
    public void notify(DelegateTask delegateTask) {
        log.info("ä»»åŠ¡åˆ›å»º: taskId={}, taskName={}", ...);
        // âŒ æ²¡æœ‰å®é™…ä¸šåŠ¡é€»è¾‘
        // âŒ æ²¡æœ‰é€šçŸ¥å‘é€
        // âŒ æ²¡æœ‰å®¡æ‰¹å†å²è®°å½•
    }
}
```
**å½±å“**ï¼šå®¡æ‰¹äººæ— æ³•åŠæ—¶æ”¶åˆ°é€šçŸ¥ï¼Œæµç¨‹çŠ¶æ€ä¸é€æ˜

**é—®é¢˜4: åŠ¨æ€å®¡æ‰¹äººæŸ¥æ‰¾é€»è¾‘å¤æ‚**
```java
@Service("deptLeaderService")
public class DeptLeaderService {
    public String findDeptLeader(Long applicantId) {
        // âŒ æŸ¥æ‰¾é€»è¾‘åˆ†æ•£
        // âŒ ç¡¬ç¼–ç è§’è‰²åç§°åŒ¹é…ï¼ˆ"ç»ç†"ï¼‰
        // âŒ æ²¡æœ‰ç¼“å­˜æœºåˆ¶
    }
}
```
**å½±å“**ï¼šæ€§èƒ½å·®ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼Œéš¾ä»¥æ‰©å±•

**é—®é¢˜5: ç¼ºå°‘æµç¨‹è®¾è®¡å™¨é›†æˆ**
```bash
# âŒ BPMNæ–‡ä»¶éœ€è¦æ‰‹åŠ¨ç¼–è¾‘
# âŒ æ²¡æœ‰å¯è§†åŒ–è®¾è®¡å·¥å…·
# âŒ éƒ¨ç½²æµç¨‹éœ€è¦æ‰‹åŠ¨ä¸Šä¼ 
```
**å½±å“**ï¼šä¸šåŠ¡äººå‘˜æ— æ³•è‡ªå·±è®¾è®¡æµç¨‹

#### 2. APIè®¾è®¡é—®é¢˜ï¼ˆä¸¥é‡åº¦ï¼šä¸­ï¼‰

**é—®é¢˜1: Controllerç›´æ¥è°ƒç”¨Serviceï¼Œç¼ºå°‘æŠ½è±¡å±‚**
```java
@RestController
@RequestMapping("/v1/workflow")
public class WorkflowController {
    private final FlowableWorkflowService flowableWorkflowService;
    
    @PostMapping("/deploy")
    public Result<Map<String, Object>> deployProcess(@RequestBody Map<String, String> request) {
        // âŒ ä¸šåŠ¡é€»è¾‘å†™åœ¨Controllerä¸­
        // âŒ æ²¡æœ‰ç»Ÿä¸€çš„APIæ‰©å±•ç‚¹
        // âŒ éš¾ä»¥æ·»åŠ æ’ä»¶é€»è¾‘
    }
}
```

**é—®é¢˜2: DTOè½¬æ¢é€»è¾‘åˆ†æ•£**
```java
// âŒ DTOè½¬æ¢é€»è¾‘å†™åœ¨Controllerä¸­
List<ProcessTaskDTO> result = new ArrayList<>();
for (Task task : tasks) {
    ProcessTaskDTO dto = new ProcessTaskDTO();
    dto.setTaskId(task.getId());
    // ... å¤§é‡é‡å¤ä»£ç 
}
```

**é—®é¢˜3: ç¼ºå°‘ç»Ÿä¸€çš„APIç‰ˆæœ¬ç®¡ç†å’Œæ‰©å±•æœºåˆ¶**
```java
// âŒ æ²¡æœ‰APIç‰ˆæœ¬æ§åˆ¶
// âŒ æ²¡æœ‰APIæ‰©å±•ç‚¹
// âŒ æ·»åŠ æ–°åŠŸèƒ½éœ€è¦ä¿®æ”¹ç°æœ‰Controller
```

#### 3. å‰ç«¯ç»„ä»¶é—®é¢˜ï¼ˆä¸¥é‡åº¦ï¼šä¸­ï¼‰

**é—®é¢˜1: è¡¨å•å­—æ®µç¡¬ç¼–ç **
```vue
<template>
  <el-form :model="formData">
    <!-- âŒ å­—æ®µç¡¬ç¼–ç  -->
    <el-form-item label="æŠ¥é”€å•å·">
      <el-input v-model="formData.transCode" />
    </el-form-item>
    <!-- ... æ›´å¤šç¡¬ç¼–ç å­—æ®µ -->
  </el-form>
</template>
```

**é—®é¢˜2: ç»„ä»¶è€¦åˆåº¦é«˜ï¼Œå¤ç”¨æ€§ä½**
```vue
<!-- âŒ æŠ¥é”€è¡¨å•ã€å€Ÿæ¬¾è¡¨å•ã€è¿˜æ¬¾è¡¨å•å¤§é‡é‡å¤ä»£ç  -->
<!-- âŒ æ²¡æœ‰ç»Ÿä¸€çš„è¡¨å•æ„å»ºå™¨ -->
<!-- âŒ å­—æ®µéªŒè¯é€»è¾‘åˆ†æ•£ -->
```

**é—®é¢˜3: ç¼ºå°‘åŠ¨æ€æ¸²æŸ“èƒ½åŠ›**
```vue
<!-- âŒ æ— æ³•æ ¹æ®æƒé™åŠ¨æ€æ˜¾ç¤ºå­—æ®µ -->
<!-- âŒ æ— æ³•æ ¹æ®ä¸šåŠ¡ç±»å‹åŠ¨æ€è°ƒæ•´è¡¨å• -->
<!-- âŒ æ— æ³•åŠ¨æ€æ·»åŠ è‡ªå®šä¹‰å­—æ®µ -->
```

---

## ğŸ—ï¸ æ–°æ¶æ„è®¾è®¡ï¼šæ’ä»¶åŒ– + å¯ç»„è£…

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

1. **æ ¸å¿ƒå¹³å° + æ’ä»¶ç”Ÿæ€**ï¼šæ ¸å¿ƒå¹³å°æä¾›åŸºç¡€èƒ½åŠ›ï¼Œä¸šåŠ¡åŠŸèƒ½é€šè¿‡æ’ä»¶å®ç°
2. **API-Firstè®¾è®¡**ï¼šæ‰€æœ‰åŠŸèƒ½é€šè¿‡APIæš´éœ²ï¼Œæ”¯æŒè‡ªå®šä¹‰æ‰©å±•
3. **äº‹ä»¶é©±åŠ¨**ï¼šé€šè¿‡äº‹ä»¶æ€»çº¿è§£è€¦ä¸šåŠ¡é€»è¾‘
4. **é…ç½®é©±åŠ¨**ï¼šæµç¨‹ã€è¡¨å•ã€æƒé™é€šè¿‡é…ç½®ç®¡ç†ï¼ŒéæŠ€æœ¯å¯ä¿®æ”¹
5. **æ¨¡å—åŒ–ç»„è£…**ï¼šå‰ç«¯ç»„ä»¶æ¨¡å—åŒ–ï¼Œæ”¯æŒåŠ¨æ€ç»„è£…

---

## ğŸ“ æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  åŠ¨æ€è¡¨å•  â”‚  â”‚  å·¥ä½œæµ   â”‚  â”‚  é€šç”¨ç»„ä»¶  â”‚  â”‚  ä¸šåŠ¡æ’ä»¶  â”‚  â”‚
â”‚  â”‚  æ’ä»¶     â”‚  â”‚  è®¾è®¡å™¨   â”‚  â”‚  åº“       â”‚  â”‚  åŒ…       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   APIç½‘å…³å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        APIæ‰©å±•ç‚¹ + æ’ä»¶é’©å­                        â”‚ â”‚
â”‚  â”‚  - Before/Afteré’©å­                                  â”‚ â”‚
â”‚  â”‚  - è‡ªå®šä¹‰APIæ³¨å†Œ                                     â”‚ â”‚
â”‚  â”‚  - æ•°æ®è½¬æ¢é’©å­                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸šåŠ¡æ’ä»¶å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æŠ¥é”€æ’ä»¶  â”‚  â”‚ å€Ÿæ¬¾æ’ä»¶   â”‚  â”‚ è¿˜æ¬¾æ’ä»¶   â”‚  â”‚ è‡ªå®šä¹‰æ’ä»¶â”‚  â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚
â”‚  â”‚ - API    â”‚  â”‚ - API    â”‚  â”‚ - API    â”‚  â”‚ - API    â”‚  â”‚
â”‚  â”‚ - Serviceâ”‚  â”‚ - Serviceâ”‚  â”‚ - Serviceâ”‚  â”‚ - Serviceâ”‚  â”‚
â”‚  â”‚ - Entity â”‚  â”‚ - Entity â”‚  â”‚ - Entity â”‚  â”‚ - Entity â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ ¸å¿ƒæœåŠ¡å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚å·¥ä½œæµå¼•æ“ â”‚  â”‚ è¡¨å•å¼•æ“  â”‚  â”‚ è§„åˆ™å¼•æ“  â”‚  â”‚ äº‹ä»¶æ€»çº¿  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ç§Ÿæˆ·éš”ç¦»  â”‚  â”‚ æƒé™ç®¡ç†  â”‚  â”‚ æ–‡ä»¶å­˜å‚¨  â”‚  â”‚ é€šçŸ¥æœåŠ¡  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®è®¿é—®å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ PostgreSQL â”‚  â”‚ Redis    â”‚  â”‚ MinIO    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. å·¥ä½œæµå¼•æ“æ’ä»¶åŒ–æ”¹é€ 

#### è®¾è®¡ç†å¿µ
å°†Flowableå¼•æ“æŠ½è±¡ä¸ºé€šç”¨å·¥ä½œæµæ¥å£ï¼Œæ”¯æŒå¤šç§å·¥ä½œæµå¼•æ“ï¼ˆFlowableã€Camundaã€Temporalç­‰ï¼‰ï¼Œå¹¶é€šè¿‡äº‹ä»¶æœºåˆ¶ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ã€‚

#### å·¥ä½œæµå¼•æ“æŠ½è±¡

```java
/**
 * å·¥ä½œæµå¼•æ“æŠ½è±¡æ¥å£
 * æ”¯æŒå¤šç§å·¥ä½œæµå®ç°
 */
public interface WorkflowEngine {
    
    /**
     * å¯åŠ¨æµç¨‹
     */
    String startProcess(StartProcessRequest request) throws WorkflowException;
    
    /**
     * å®Œæˆä»»åŠ¡
     */
    void completeTask(CompleteTaskRequest request) throws WorkflowException;
    
    /**
     * æŸ¥è¯¢å¾…åŠä»»åŠ¡
     */
    List<Task> queryPendingTasks(QueryTasksRequest request) throws WorkflowException;
    
    /**
     * æ³¨å†Œæµç¨‹ç›‘å¬å™¨
     */
    void registerListener(WorkflowListener listener);
}

/**
 * å·¥ä½œæµäº‹ä»¶ç›‘å¬å™¨
 */
public interface WorkflowListener {
    
    /**
     * æµç¨‹å¯åŠ¨äº‹ä»¶
     */
    void onProcessStarted(ProcessEvent event);
    
    /**
     * ä»»åŠ¡åˆ›å»ºäº‹ä»¶
     */
    void onTaskCreated(TaskEvent event);
    
    /**
     * ä»»åŠ¡å®Œæˆäº‹ä»¶
     */
    void onTaskCompleted(TaskEvent event);
    
    /**
     * æµç¨‹å®Œæˆäº‹ä»¶
     */
    void onProcessCompleted(ProcessEvent event);
    
    /**
     * æµç¨‹å–æ¶ˆ/é©³å›äº‹ä»¶
     */
    void onProcessCancelled(ProcessEvent event);
}

/**
 * Flowableå®ç°
 */
@Component
@ConditionalOnProperty(name = "workflow.engine", havingValue = "flowable")
public class FlowableWorkflowEngine implements WorkflowEngine {
    
    @Autowired
    private RuntimeService runtimeService;
    
    @Autowired
    private TaskService taskService;
    
    private List<WorkflowListener> listeners = new ArrayList<>();
    
    @Override
    public String startProcess(StartProcessRequest request) {
        ProcessInstance instance = runtimeService.createProcessInstanceBuilder()
            .processDefinitionKey(request.getProcessKey())
            .tenantId(request.getTenantId())
            .businessKey(request.getBusinessKey())
            .variables(request.getVariables())
            .start();
        
        // è§¦å‘äº‹ä»¶
        listeners.forEach(l -> l.onProcessStarted(new ProcessEvent(
            instance.getId(),
            instance.getProcessDefinitionId(),
            request.getBusinessKey(),
            request.getVariables()
        )));
        
        return instance.getId();
    }
    
    @Override
    public void completeTask(CompleteTaskRequest request) {
        Task task = taskService.createTaskQuery()
            .taskId(request.getTaskId())
            .singleResult();
        
        taskService.complete(request.getTaskId(), request.getVariables());
        
        // è§¦å‘äº‹ä»¶
        listeners.forEach(l -> l.onTaskCompleted(new TaskEvent(
            request.getTaskId(),
            task.getName(),
            task.getProcessInstanceId(),
            request.getComment()
        )));
    }
    
    @Override
    public void registerListener(WorkflowListener listener) {
        listeners.add(listener);
    }
}
```

#### æµç¨‹å®šä¹‰é…ç½®åŒ–

ä½¿ç”¨JSONé…ç½®æ›¿ä»£ç¡¬ç¼–ç çš„BPMN XMLï¼š

```json
{
  "processKey": "REIMBURSEMENT_APPROVAL_STANDARD",
  "processName": "æ ‡å‡†æŠ¥é”€å®¡æ‰¹æµç¨‹",
  "version": 1,
  "nodes": [
    {
      "id": "start",
      "type": "startEvent",
      "name": "å¼€å§‹"
    },
    {
      "id": "projectManagerApproval",
      "type": "userTask",
      "name": "é¡¹ç›®ç»ç†å®¡æ‰¹",
      "assigneeType": "candidateGroup",
      "assigneeExpression": "PROJECT_MANAGER",
      "config": {
        "approvalType": "approval",
        "allowReject": true,
        "allowDelegate": true
      }
    },
    {
      "id": "deptManagerApproval",
      "type": "userTask",
      "name": "éƒ¨é—¨ç»ç†å®¡æ‰¹",
      "assigneeType": "expression",
      "assigneeExpression": "${approvalService.findDeptLeader(applicantId)}",
      "config": {
        "approvalType": "approval",
        "allowReject": true,
        "allowDelegate": true
      }
    },
    {
      "id": "amountGateway",
      "type": "exclusiveGateway",
      "name": "é‡‘é¢åˆ¤æ–­",
      "conditions": [
        {
          "target": "ceoApproval",
          "expression": "${amount > 10000}",
          "description": "é‡‘é¢å¤§äº10000ï¼Œéœ€è¦æ€»ç»ç†å®¡æ‰¹"
        },
        {
          "target": "financeApproval",
          "expression": "${amount <= 10000}",
          "description": "é‡‘é¢å°äºç­‰äº10000ï¼Œç›´æ¥åˆ°è´¢åŠ¡å®¡æ‰¹"
        }
      ]
    },
    {
      "id": "ceoApproval",
      "type": "userTask",
      "name": "æ€»ç»ç†å®¡æ‰¹",
      "assigneeType": "candidateGroup",
      "assigneeExpression": "CEO"
    },
    {
      "id": "financeApproval",
      "type": "userTask",
      "name": "è´¢åŠ¡å®¡æ‰¹",
      "assigneeType": "candidateGroup",
      "assigneeExpression": "FINANCE"
    },
    {
      "id": "end",
      "type": "endEvent",
      "name": "ç»“æŸ"
    }
  ],
  "edges": [
    {"from": "start", "to": "projectManagerApproval"},
    {"from": "projectManagerApproval", "to": "deptManagerApproval"},
    {"from": "deptManagerApproval", "to": "amountGateway"},
    {"from": "amountGateway", "to": "ceoApproval", "condition": "${amount > 10000}"},
    {"from": "amountGateway", "to": "financeApproval", "condition": "${amount <= 10000}"},
    {"from": "ceoApproval", "to": "financeApproval"},
    {"from": "financeApproval", "to": "end"}
  ],
  "variables": {
    "amount": {
      "type": "decimal",
      "description": "å®¡æ‰¹é‡‘é¢",
      "required": true
    },
    "applicantId": {
      "type": "long",
      "description": "ç”³è¯·äººID",
      "required": true
    }
  }
}
```

#### ä¸šåŠ¡çŠ¶æ€åŒæ­¥æ’ä»¶

```java
/**
 * æŠ¥é”€ä¸šåŠ¡çŠ¶æ€åŒæ­¥æ’ä»¶
 * ç›‘å¬å·¥ä½œæµäº‹ä»¶ï¼ŒåŒæ­¥ä¸šåŠ¡çŠ¶æ€
 */
@Component
public class TransWorkflowListener implements WorkflowListener {
    
    @Autowired
    private TransService transService;
    
    @Autowired
    private NotificationService notificationService;
    
    @Override
    public void onProcessStarted(ProcessEvent event) {
        log.info("æŠ¥é”€æµç¨‹å¯åŠ¨: processInstanceId={}, businessKey={}", 
                 event.getProcessInstanceId(), event.getBusinessKey());
        
        // æ›´æ–°æŠ¥é”€å•çŠ¶æ€ä¸º"å®¡æ‰¹ä¸­"
        transService.updateState(event.getBusinessKey(), 2);
    }
    
    @Override
    public void onTaskCreated(TaskEvent event) {
        log.info("å®¡æ‰¹ä»»åŠ¡åˆ›å»º: taskId={}, taskName={}", 
                 event.getTaskId(), event.getTaskName());
        
        // è·å–ä»»åŠ¡å€™é€‰äºº/å€™é€‰äººç»„
        List<String> candidates = getTaskCandidates(event.getTaskId());
        
        // å‘é€å®¡æ‰¹é€šçŸ¥
        notificationService.sendApprovalNotification(
            candidates, 
            event.getTaskId(), 
            event.getTaskName(),
            event.getProcessInstanceId()
        );
    }
    
    @Override
    public void onTaskCompleted(TaskEvent event) {
        log.info("å®¡æ‰¹ä»»åŠ¡å®Œæˆ: taskId={}, comment={}", 
                 event.getTaskId(), event.getComment());
        
        // è®°å½•å®¡æ‰¹å†å²
        transService.addApprovalHistory(
            event.getProcessInstanceId(),
            event.getTaskId(),
            event.getTaskName(),
            event.getComment()
        );
        
        // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨å®¡æ‰¹å®Œæˆ
        if (isLastApprovalTask(event.getProcessInstanceId())) {
            transService.updateState(event.getBusinessKey(), 3);
        }
    }
    
    @Override
    public void onProcessCompleted(ProcessEvent event) {
        log.info("æŠ¥é”€æµç¨‹å®Œæˆ: processInstanceId={}, businessKey={}", 
                 event.getProcessInstanceId(), event.getBusinessKey());
        
        // æ›´æ–°æŠ¥é”€å•çŠ¶æ€ä¸º"å·²é€šè¿‡"
        transService.updateState(event.getBusinessKey(), 5);
        
        // å‘é€å®Œæˆé€šçŸ¥
        notificationService.sendApprovalCompletedNotification(
            event.getBusinessKey()
        );
    }
    
    @Override
    public void onProcessCancelled(ProcessEvent event) {
        log.info("æŠ¥é”€æµç¨‹å–æ¶ˆ/é©³å›: processInstanceId={}, businessKey={}", 
                 event.getProcessInstanceId(), event.getBusinessKey());
        
        // æ›´æ–°æŠ¥é”€å•çŠ¶æ€ä¸º"å·²é©³å›"
        transService.updateState(event.getBusinessKey(), 4);
        
        // å‘é€é©³å›é€šçŸ¥
        notificationService.sendApprovalRejectedNotification(
            event.getBusinessKey(),
            event.getRejectReason()
        );
    }
}
```

#### åŠ¨æ€å®¡æ‰¹äººæœåŠ¡

```java
/**
 * åŠ¨æ€å®¡æ‰¹äººæœåŠ¡æ¥å£
 * æ”¯æŒå¤šç§å®¡æ‰¹äººæŸ¥æ‰¾ç­–ç•¥
 */
public interface ApprovalAssigneeService {
    
    /**
     * æŸ¥æ‰¾å®¡æ‰¹äºº
     */
    List<String> findAssignees(AssigneeContext context) throws AssigneeException;
}

/**
 * ä¸Šä¸‹æ–‡å¯¹è±¡
 */
public class AssigneeContext {
    private String processDefinitionKey;
    private String taskDefinitionKey;
    private String tenantId;
    private String businessKey;
    private Map<String, Object> processVariables;
    private Map<String, Object> taskVariables;
    // getters and setters
}

/**
 * éƒ¨é—¨è´Ÿè´£äººæŸ¥æ‰¾å®ç°
 */
@Service("deptLeaderAssigneeService")
public class DeptLeaderAssigneeService implements ApprovalAssigneeService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Autowired
    private RoleMapper roleMapper;
    
    @Autowired
    private UserRoleMapper userRoleMapper;
    
    @Autowired
    private PluginConfigService configService;
    
    @Override
    public List<String> findAssignees(AssigneeContext context) {
        Long applicantId = (Long) context.getProcessVariables().get("applicantId");
        Long tenantId = Long.parseLong(context.getTenantId());
        
        // ä»é…ç½®ä¸­è¯»å–è§’è‰²åç§°ï¼ˆå¯é…ç½®ï¼‰
        String managerRolePattern = configService.getConfig(
            tenantId, 
            "approval.deptManager.rolePattern", 
            "ç»ç†"
        );
        
        // 1. æŸ¥è¯¢ç”³è¯·äººä¿¡æ¯
        User applicant = userMapper.selectById(applicantId);
        if (applicant == null) {
            throw new AssigneeException("ç”³è¯·äººä¸å­˜åœ¨");
        }
        
        // 2. è·å–ç”³è¯·äººçš„éƒ¨é—¨ID
        Long orgId = applicant.getOrgId();
        if (orgId == null) {
            throw new AssigneeException("ç”³è¯·äººæ²¡æœ‰æ‰€å±éƒ¨é—¨");
        }
        
        // 3. æŸ¥æ‰¾è¯¥éƒ¨é—¨çš„ç»ç†è§’è‰²
        List<Role> managerRoles = roleMapper.selectList(
            new LambdaQueryWrapper<Role>()
                .eq(Role::getTenantId, tenantId)
                .eq(Role::getOrgId, orgId)
                .like(Role::getRoleName, managerRolePattern)
        );
        
        if (managerRoles == null || managerRoles.isEmpty()) {
            throw new AssigneeException("æœªæ‰¾åˆ°éƒ¨é—¨ç»ç†è§’è‰²");
        }
        
        // 4. æŸ¥æ‰¾æ‹¥æœ‰è¿™äº›è§’è‰²çš„ç”¨æˆ·
        List<Long> managerRoleIds = managerRoles.stream()
            .map(Role::getRoleId)
            .collect(Collectors.toList());
        
        List<UserRole> userRoles = userRoleMapper.selectList(
            new LambdaQueryWrapper<UserRole>()
                .eq(UserRole::getTenantId, tenantId)
                .in(UserRole::getRoleId, managerRoleIds)
        );
        
        // 5. è¿”å›ç”¨æˆ·IDåˆ—è¡¨
        return userRoles.stream()
            .map(ur -> String.valueOf(ur.getUserId()))
            .collect(Collectors.toList());
    }
}

/**
 * å®¡æ‰¹äººæœåŠ¡å·¥å‚
 * æ ¹æ®é…ç½®åŠ¨æ€é€‰æ‹©å®¡æ‰¹äººæŸ¥æ‰¾ç­–ç•¥
 */
@Service
public class ApprovalAssigneeServiceFactory {
    
    @Autowired
    private Map<String, ApprovalAssigneeService> assigneeServices;
    
    @Autowired
    private PluginConfigService configService;
    
    public ApprovalAssigneeService getService(String taskDefinitionKey) {
        // ä»é…ç½®ä¸­è¯»å–è¯¥ä»»åŠ¡ä½¿ç”¨çš„å®¡æ‰¹äººæŸ¥æ‰¾æœåŠ¡
        String serviceName = configService.getConfig(
            TenantContextHolder.getTenantId(),
            "approval.assignee." + taskDefinitionKey,
            "default"  // é»˜è®¤æœåŠ¡
        );
        
        ApprovalAssigneeService service = assigneeServices.get(serviceName);
        if (service == null) {
            throw new AssigneeException("å®¡æ‰¹äººæœåŠ¡ä¸å­˜åœ¨: " + serviceName);
        }
        
        return service;
    }
}
```

### 2. è¡¨å•å¼•æ“æ’ä»¶åŒ–æ”¹é€ 

#### åŠ¨æ€è¡¨å•é…ç½®

```json
{
  "formKey": "reimbursementForm",
  "formName": "æŠ¥é”€ç”³è¯·å•",
  "version": 1,
  "fields": [
    {
      "fieldId": "transCode",
      "fieldName": "æŠ¥é”€å•å·",
      "fieldType": "text",
      "required": true,
      "editable": false,
      "defaultValue": "${transService.generateCode()}",
      "validations": [
        {
          "type": "pattern",
          "pattern": "^BX\\d{12}$",
          "message": "æŠ¥é”€å•å·æ ¼å¼ä¸æ­£ç¡®"
        }
      ]
    },
    {
      "fieldId": "transTypeId",
      "fieldName": "æŠ¥é”€ç±»å‹",
      "fieldType": "select",
      "required": true,
      "editable": true,
      "dataSource": {
        "type": "api",
        "url": "/api/v1/trans-types",
        "valueField": "transTypeId",
        "labelField": "transTypeName"
      }
    },
    {
      "fieldId": "transCharge",
      "fieldName": "æŠ¥é”€é‡‘é¢",
      "fieldType": "decimal",
      "required": true,
      "editable": true,
      "validations": [
        {
          "type": "min",
          "value": 0.01,
          "message": "æŠ¥é”€é‡‘é¢å¿…é¡»å¤§äº0"
        },
        {
          "type": "max",
          "value": 1000000,
          "message": "æŠ¥é”€é‡‘é¢ä¸èƒ½è¶…è¿‡100ä¸‡å…ƒ"
        }
      ]
    },
    {
      "fieldId": "projectId",
      "fieldName": "é¡¹ç›®",
      "fieldType": "select",
      "required": true,
      "editable": true,
      "dataSource": {
        "type": "api",
        "url": "/api/v1/projects",
        "valueField": "projectId",
        "labelField": "projectName"
      }
    },
    {
      "fieldId": "transDesc",
      "fieldName": "æŠ¥é”€è¯´æ˜",
      "fieldType": "textarea",
      "required": false,
      "editable": true,
      "validations": [
        {
          "type": "maxLength",
          "value": 500,
          "message": "æŠ¥é”€è¯´æ˜ä¸èƒ½è¶…è¿‡500å­—"
        }
      ]
    },
    {
      "fieldId": "currencyId",
      "fieldName": "å¸ç§",
      "fieldType": "select",
      "required": true,
      "editable": true,
      "defaultValue": "1",
      "dataSource": {
        "type": "api",
        "url": "/api/v1/currencies",
        "valueField": "currencyId",
        "labelField": "currencyName"
      }
    },
    {
      "fieldId": "attachments",
      "fieldName": "é™„ä»¶",
      "fieldType": "fileUpload",
      "required": false,
      "editable": true,
      "config": {
        "maxFiles": 10,
        "maxSize": 52428800,
        "acceptTypes": [".pdf", ".jpg", ".png", ".jpeg"]
      }
    },
    {
      "fieldId": "items",
      "fieldName": "æŠ¥é”€æ˜ç»†",
      "fieldType": "dynamicTable",
      "required": true,
      "editable": true,
      "columns": [
        {
          "fieldId": "expenseItemTypeId",
          "fieldName": "è´¹ç”¨ç±»å‹",
          "fieldType": "select",
          "required": true,
          "dataSource": {
            "type": "api",
            "url": "/api/v1/expense-item-types",
            "valueField": "expenseItemTypeId",
            "labelField": "expenseItemTypeName"
          }
        },
        {
          "fieldId": "chargeAmount",
          "fieldName": "é‡‘é¢",
          "fieldType": "decimal",
          "required": true
        },
        {
          "fieldId": "chargeDesc",
          "fieldName": "è¯´æ˜",
          "fieldType": "text",
          "required": false
        }
      ]
    }
  ],
  "rules": [
    {
      "id": "validateTotalAmount",
      "name": "éªŒè¯æ€»é‡‘é¢",
      "type": "expression",
      "expression": "sum(items[*].chargeAmount) == transCharge",
      "message": "æ˜ç»†é‡‘é¢æ€»å’Œå¿…é¡»ç­‰äºæŠ¥é”€é‡‘é¢"
    }
  ],
  "actions": [
    {
      "id": "saveDraft",
      "name": "ä¿å­˜è‰ç¨¿",
      "type": "button",
      "style": "default",
      "api": "/api/v1/trans/draft",
      "method": "POST"
    },
    {
      "id": "submit",
      "name": "æäº¤å®¡æ‰¹",
      "type": "button",
      "style": "primary",
      "api": "/api/v1/trans/submit",
      "method": "POST",
      "confirm": "ç¡®è®¤æäº¤å®¡æ‰¹ï¼Ÿæäº¤åå°†æ— æ³•ä¿®æ”¹"
    }
  ]
}
```

#### è¡¨å•æ¸²æŸ“å¼•æ“

```typescript
// DynamicFormRenderer.ts
import { ref, reactive, computed } from 'vue'
import { useForm } from '@/composables/useForm'
import { loadFormConfig } from '@/api/form'

export default {
  name: 'DynamicFormRenderer',
  
  props: {
    formKey: {
      type: String,
      required: true
    },
    formData: {
      type: Object,
      default: () => ({})
    },
    mode: {
      type: String,
      default: 'edit' // 'view' | 'edit' | 'approve'
    }
  },
  
  async setup(props, { emit }) {
    const formConfig = ref(null)
    const loading = ref(true)
    
    // åŠ¨æ€è¡¨å•çŠ¶æ€
    const formState = reactive({
      fields: {},
      errors: {},
      touched: {}
    })
    
    // åŠ è½½è¡¨å•é…ç½®
    const loadConfig = async () => {
      loading.value = true
      try {
        formConfig.value = await loadFormConfig(props.formKey)
        
        // åˆå§‹åŒ–è¡¨å•å­—æ®µå€¼
        formConfig.value.fields.forEach(field => {
          if (!(field.fieldId in props.formData)) {
            // ä½¿ç”¨é»˜è®¤å€¼
            formState.fields[field.fieldId] = getDefaultValue(field)
          } else {
            formState.fields[field.fieldId] = props.formData[field.fieldId]
          }
        })
      } catch (error) {
        console.error('åŠ è½½è¡¨å•é…ç½®å¤±è´¥:', error)
      } finally {
        loading.value = false
      }
    }
    
    // è·å–å­—æ®µé»˜è®¤å€¼
    const getDefaultValue = (field) => {
      if (field.defaultValue) {
        // å¤„ç†è¡¨è¾¾å¼ç±»å‹çš„é»˜è®¤å€¼
        if (typeof field.defaultValue === 'string' && 
            field.defaultValue.startsWith('${')) {
          // è°ƒç”¨APIè·å–é»˜è®¤å€¼
          return evaluateExpression(field.defaultValue)
        }
        return field.defaultValue
      }
      
      switch (field.fieldType) {
        case 'text': return ''
        case 'number': return 0
        case 'decimal': return 0.00
        case 'select': return null
        case 'date': return new Date().toISOString().split('T')[0]
        case 'fileUpload': return []
        case 'dynamicTable': return []
        default: return null
      }
    }
    
    // è¡¨å•éªŒè¯
    const validateField = (field, value) => {
      const errors = []
      
      // å¿…å¡«éªŒè¯
      if (field.required && !value) {
        errors.push(`${field.fieldName}ä¸èƒ½ä¸ºç©º`)
        return errors
      }
      
      // ç±»å‹éªŒè¯
      if (field.validations) {
        field.validations.forEach(validation => {
          const error = runValidation(validation, value)
          if (error) errors.push(error)
        })
      }
      
      return errors
    }
    
    // è¿è¡ŒéªŒè¯è§„åˆ™
    const runValidation = (validation, value) => {
      switch (validation.type) {
        case 'pattern':
          return new RegExp(validation.pattern).test(value)
            ? null
            : validation.message
        
        case 'min':
          return value >= validation.value ? null : validation.message
        
        case 'max':
          return value <= validation.value ? null : validation.message
        
        case 'maxLength':
          return value.length <= validation.value ? null : validation.message
        
        default:
          return null
      }
    }
    
    // å­—æ®µå˜æ›´å¤„ç†
    const handleFieldChange = (fieldId, value) => {
      formState.fields[fieldId] = value
      formState.touched[fieldId] = true
      
      // éªŒè¯å­—æ®µ
      const field = formConfig.value.fields.find(f => f.fieldId === fieldId)
      if (field) {
        const errors = validateField(field, value)
        formState.errors[fieldId] = errors
        
        // è§¦å‘è¡¨å•çº§è§„åˆ™éªŒè¯
        validateFormRules()
      }
      
      // è§¦å‘äº‹ä»¶
      emit('field-change', { fieldId, value })
    }
    
    // è¡¨å•çº§è§„åˆ™éªŒè¯
    const validateFormRules = () => {
      if (!formConfig.value.rules) return
      
      formConfig.value.rules.forEach(rule => {
        if (rule.type === 'expression') {
          // ä½¿ç”¨ç®€æ˜“è¡¨è¾¾å¼æ±‚å€¼
          try {
            const result = evaluateExpression(rule.expression, formState.fields)
            if (!result) {
              // è¡¨å•çº§é”™è¯¯å¯ä»¥å­˜å‚¨åœ¨é¡¶å±‚
              console.warn('è¡¨å•è§„åˆ™éªŒè¯å¤±è´¥:', rule.message)
            }
          } catch (error) {
            console.error('è¡¨è¾¾å¼æ±‚å€¼é”™è¯¯:', error)
          }
        }
      })
    }
    
    // ç®€æ˜“è¡¨è¾¾å¼æ±‚å€¼
    const evaluateExpression = (expression, context = formState.fields) => {
      // æ›¿æ¢è¡¨è¾¾å¼ä¸­çš„å˜é‡
      let expr = expression
      Object.keys(context).forEach(key => {
        const value = context[key]
        const regex = new RegExp(`\\$\\{${key}\\.([^}]+)\\}`, 'g')
        expr = expr.replace(regex, (_, path) => {
          return getNestedValue(value, path)
        })
      })
      
      // ç®€åŒ–ç‰ˆï¼Œå®é™…åº”è¯¥ä½¿ç”¨æ›´å®‰å…¨çš„è¡¨è¾¾å¼å¼•æ“
      try {
        return eval(expr)
      } catch (error) {
        console.error('è¡¨è¾¾å¼æ±‚å€¼å¤±è´¥:', expr, error)
        return false
      }
    }
    
    const getNestedValue = (obj, path) => {
      return path.split('.').reduce((o, k) => (o || {})[k], obj)
    }
    
    // è¡¨å•æäº¤
    const submit = async (actionId) => {
      // éªŒè¯æ‰€æœ‰å­—æ®µ
      let isValid = true
      formConfig.value.fields.forEach(field => {
        const errors = validateField(field, formState.fields[field.fieldId])
        if (errors.length > 0) {
          formState.errors[field.fieldId] = errors
          isValid = false
        }
      })
      
      if (!isValid) {
        throw new Error('è¡¨å•éªŒè¯å¤±è´¥')
      }
      
      // æŸ¥æ‰¾æŒ‰é’®é…ç½®
      const action = formConfig.value.actions.find(a => a.id === actionId)
      if (action) {
        emit('submit', {
          actionId,
          formData: formState.fields,
          api: action.api,
          method: action.method
        })
      }
    }
    
    // è®¡ç®—å±æ€§
    const formFields = computed(() => {
      return formConfig.value?.fields || []
    })
    
    const formActions = computed(() => {
      return formConfig.value?.actions || []
    })
    
    const isViewMode = computed(() => props.mode === 'view')
    const isEditMode = computed(() => props.mode === 'edit')
    const isApproveMode = computed(() => props.mode === 'approve')
    
    // ç”Ÿå‘½å‘¨æœŸ
    await loadConfig()
    
    return {
      loading,
      formConfig,
      formState,
      formFields,
      formActions,
      isViewMode,
      isEditMode,
      isApproveMode,
      handleFieldChange,
      submit
    }
  }
}
```

### 3. APIæ‰©å±•ç‚¹è®¾è®¡

#### APIæ‰©å±•ç‚¹æ³¨å†Œ

```java
/**
 * APIæ‰©å±•ç‚¹æ³¨å†Œè¡¨
 */
public interface ApiExtensionRegistry {
    
    /**
     * æ³¨å†ŒBeforeé’©å­
     */
    void registerBeforeHook(String apiPath, ApiHook hook);
    
    /**
     * æ³¨å†ŒAfteré’©å­
     */
    void registerAfterHook(String apiPath, ApiHook hook);
    
    /**
     * æ³¨å†Œè‡ªå®šä¹‰API
     */
    void registerCustomApi(String apiPath, ApiHandler handler);
    
    /**
     * æ³¨å†Œæ•°æ®è½¬æ¢å™¨
     */
    void registerDataConverter(String apiPath, DataConverter converter);
}

/**
 * APIé’©å­æ¥å£
 */
@FunctionalInterface
public interface ApiHook {
    
    /**
     * æ‰§è¡Œé’©å­é€»è¾‘
     * @param context APIä¸Šä¸‹æ–‡
     * @return è¿”å›trueç»§ç»­æ‰§è¡Œï¼Œfalseä¸­æ–­
     */
    boolean execute(ApiContext context) throws ApiException;
}

/**
 * APIä¸Šä¸‹æ–‡
 */
public class ApiContext {
    private String apiPath;
    private String httpMethod;
    private Map<String, Object> headers;
    private Map<String, Object> pathVariables;
    private Map<String, Object> requestParams;
    private Map<String, Object> requestBody;
    private Object responseData;
    private Exception exception;
    
    private Map<String, Object> metadata = new HashMap<>();
    
    // getters and setters
    
    public void putMetadata(String key, Object value) {
        metadata.put(key, value);
    }
    
    @SuppressWarnings("unchecked")
    public <T> T getMetadata(String key, Class<T> type) {
        return (T) metadata.get(key);
    }
}

/**
 * APIæ‰©å±•ç‚¹å®ç°
 */
@Component
public class DefaultApiExtensionRegistry implements ApiExtensionRegistry {
    
    // APIè·¯å¾„ -> Beforeé’©å­åˆ—è¡¨
    private Map<String, List<ApiHook>> beforeHooks = new ConcurrentHashMap<>();
    
    // APIè·¯å¾„ -> Afteré’©å­åˆ—è¡¨
    private Map<String, List<ApiHook>> afterHooks = new ConcurrentHashMap<>();
    
    // è‡ªå®šä¹‰APIæ³¨å†Œè¡¨
    private Map<String, ApiHandler> customApis = new ConcurrentHashMap<>();
    
    // æ•°æ®è½¬æ¢å™¨æ³¨å†Œè¡¨
    private Map<String, DataConverter> dataConverters = new ConcurrentHashMap<>();
    
    @Override
    public void registerBeforeHook(String apiPath, ApiHook hook) {
        beforeHooks.computeIfAbsent(apiPath, k -> new ArrayList<>()).add(hook);
    }
    
    @Override
    public void registerAfterHook(String apiPath, ApiHook hook) {
        afterHooks.computeIfAbsent(apiPath, k -> new ArrayList<>()).add(hook);
    }
    
    @Override
    public void registerCustomApi(String apiPath, ApiHandler handler) {
        customApis.put(apiPath, handler);
    }
    
    @Override
    public void registerDataConverter(String apiPath, DataConverter converter) {
        dataConverters.put(apiPath, converter);
    }
    
    /**
     * æ‰§è¡ŒBeforeé’©å­
     */
    public boolean executeBeforeHooks(String apiPath, ApiContext context) {
        List<ApiHook> hooks = beforeHooks.get(apiPath);
        if (hooks == null || hooks.isEmpty()) {
            return true;
        }
        
        for (ApiHook hook : hooks) {
            boolean result = hook.execute(context);
            if (!result) {
                return false;  // ä¸­æ–­æ‰§è¡Œ
            }
        }
        
        return true;
    }
    
    /**
     * æ‰§è¡ŒAfteré’©å­
     */
    public void executeAfterHooks(String apiPath, ApiContext context) {
        List<ApiHook> hooks = afterHooks.get(apiPath);
        if (hooks == null || hooks.isEmpty()) {
            return;
        }
        
        for (ApiHook hook : hooks) {
            try {
                hook.execute(context);
            } catch (Exception e) {
                log.error("Afteré’©å­æ‰§è¡Œå¤±è´¥: apiPath={}, hook={}", apiPath, hook, e);
            }
        }
    }
    
    /**
     * è·å–è‡ªå®šä¹‰APIå¤„ç†å™¨
     */
    public ApiHandler getCustomApiHandler(String apiPath) {
        return customApis.get(apiPath);
    }
    
    /**
     * æ‰§è¡Œæ•°æ®è½¬æ¢
     */
    public Object convertData(String apiPath, Object data) {
        DataConverter converter = dataConverters.get(apiPath);
        if (converter == null) {
            return data;
        }
        
        return converter.convert(data);
    }
}
```

#### APIæ‰©å±•ç‚¹ä½¿ç”¨ç¤ºä¾‹

```java
/**
 * æŠ¥é”€å®¡æ‰¹APIæ‰©å±•æ’ä»¶
 */
@Component
public class TransApprovalApiExtension implements Plugin {
    
    @Autowired
    private ApiExtensionRegistry registry;
    
    @Autowired
    private TransService transService;
    
    @Autowired
    private NotificationService notificationService;
    
    @Override
    public void init() {
        // æ³¨å†ŒBeforeé’©å­ï¼šå®¡æ‰¹å‰æ ¡éªŒ
        registry.registerBeforeHook(
            "/v1/trans/{id}/approve",
            this::validateBeforeApproval
        );
        
        // æ³¨å†ŒAfteré’©å­ï¼šå®¡æ‰¹åå¤„ç†
        registry.registerAfterHook(
            "/v1/trans/{id}/approve",
            this::handleAfterApproval
        );
        
        // æ³¨å†Œæ•°æ®è½¬æ¢å™¨
        registry.registerDataConverter(
            "/v1/trans/{id}/approve",
            this::convertApprovalRequest
        );
    }
    
    /**
     * å®¡æ‰¹å‰æ ¡éªŒ
     */
    private boolean validateBeforeApproval(ApiContext context) {
        Long transId = (Long) context.getPathVariables().get("id");
        String action = (String) context.getRequestParams().get("action");
        
        // æŸ¥è¯¢æŠ¥é”€å•
        Trans trans = transService.getById(transId);
        if (trans == null) {
            throw new ApiException("æŠ¥é”€å•ä¸å­˜åœ¨");
        }
        
        // æ ¡éªŒæŠ¥é”€å•çŠ¶æ€
        if (trans.getState() != 2) {  // 2=å®¡æ‰¹ä¸­
            throw new ApiException("æŠ¥é”€å•çŠ¶æ€ä¸å…è®¸å®¡æ‰¹");
        }
        
        // å­˜å‚¨æŠ¥é”€å•åˆ°ä¸Šä¸‹æ–‡ï¼Œä¾›åç»­é’©å­ä½¿ç”¨
        context.putMetadata("trans", trans);
        
        return true;
    }
    
    /**
     * å®¡æ‰¹åå¤„ç†
     */
    private boolean handleAfterApproval(ApiContext context) {
        Trans trans = context.getMetadata("trans", Trans.class);
        String action = (String) context.getRequestParams().get("action");
        
        if ("reject".equals(action)) {
            // é©³å›å¤„ç†
            transService.handleRejection(trans);
            
            // å‘é€é©³å›é€šçŸ¥
            notificationService.sendRejectionNotification(
                trans.getCreatedUserId(),
                trans.getTransId()
            );
        } else if ("approve".equals(action)) {
            // é€šè¿‡å¤„ç†
            transService.handleApproval(trans);
            
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å®¡æ‰¹éƒ½å·²å®Œæˆ
            if (transService.isAllApprovalsCompleted(trans.getTransId())) {
                transService.completeTrans(trans.getTransId());
                
                // å‘é€å®Œæˆé€šçŸ¥
                notificationService.sendCompletionNotification(
                    trans.getCreatedUserId(),
                    trans.getTransId()
                );
            }
        }
        
        return true;
    }
    
    /**
     * æ•°æ®è½¬æ¢
     */
    private Object convertApprovalRequest(Object data) {
        // è½¬æ¢å®¡æ‰¹è¯·æ±‚ä¸ºç»Ÿä¸€æ ¼å¼
        Map<String, Object> request = (Map<String, Object>) data;
        
        ApprovalRequest approvalRequest = new ApprovalRequest();
        approvalRequest.setAction((String) request.get("action"));
        approvalRequest.setComment((String) request.get("comment"));
        approvalRequest.setApprovalResult((String) request.get("approvalResult"));
        
        return approvalRequest;
    }
}
```

### 4. æ’ä»¶åŠ è½½æœºåˆ¶

#### æ’ä»¶æ¥å£å®šä¹‰

```java
/**
 * æ’ä»¶æ¥å£
 */
public interface Plugin {
    
    /**
     * æ’ä»¶åç§°
     */
    String getName();
    
    /**
     * æ’ä»¶ç‰ˆæœ¬
     */
    String getVersion();
    
    /**
     * æ’ä»¶æè¿°
     */
    String getDescription();
    
    /**
     * åˆå§‹åŒ–æ’ä»¶
     */
    void init() throws PluginException;
    
    /**
     * å¯åŠ¨æ’ä»¶
     */
    void start() throws PluginException;
    
    /**
     * åœæ­¢æ’ä»¶
     */
    void stop() throws PluginException;
    
    /**
     * è·å–æ’ä»¶ä¾èµ–
     */
    List<String> getDependencies();
    
    /**
     * è·å–æ’ä»¶æä¾›çš„APIæ‰©å±•ç‚¹
     */
    List<ApiExtension> getApiExtensions();
    
    /**
     * è·å–æ’ä»¶æä¾›çš„å‰ç«¯ç»„ä»¶
     */
    List<FrontendComponent> getFrontendComponents();
}

/**
 * APIæ‰©å±•ç‚¹å®šä¹‰
 */
public class ApiExtension {
    private String apiPath;
    private String httpMethod;
    private ApiHandler handler;
    private List<String> requiredPermissions;
    
    // getters and setters
}

/**
 * å‰ç«¯ç»„ä»¶å®šä¹‰
 */
public class FrontendComponent {
    private String componentId;
    private String componentPath;
    private String componentName;
    private Map<String, Object> props;
    private List<String> requiredPermissions;
    
    // getters and setters
}
```

#### æ’ä»¶ç®¡ç†å™¨

```java
/**
 * æ’ä»¶ç®¡ç†å™¨
 */
@Component
public class PluginManager {
    
    @Autowired
    private ApiExtensionRegistry apiExtensionRegistry;
    
    @Autowired
    private ApplicationContext applicationContext;
    
    // å·²åŠ è½½çš„æ’ä»¶
    private Map<String, Plugin> loadedPlugins = new ConcurrentHashMap<>();
    
    // æ’ä»¶çŠ¶æ€
    private Map<String, PluginState> pluginStates = new ConcurrentHashMap<>();
    
    /**
     * åŠ è½½æ’ä»¶
     */
    public void loadPlugin(Plugin plugin) throws PluginException {
        String pluginName = plugin.getName();
        
        log.info("åŠ è½½æ’ä»¶: name={}, version={}", 
                 pluginName, plugin.getVersion());
        
        // æ£€æŸ¥ä¾èµ–
        for (String dep : plugin.getDependencies()) {
            if (!loadedPlugins.containsKey(dep)) {
                throw new PluginException(
                    String.format("æ’ä»¶ä¾èµ–æœªæ»¡è¶³: %s ä¾èµ– %s", pluginName, dep)
                );
            }
        }
        
        // åˆå§‹åŒ–æ’ä»¶
        try {
            plugin.init();
            pluginStates.put(pluginName, PluginState.INITIALIZED);
            log.info("æ’ä»¶åˆå§‹åŒ–æˆåŠŸ: {}", pluginName);
        } catch (Exception e) {
            pluginStates.put(pluginName, PluginState.FAILED);
            throw new PluginException("æ’ä»¶åˆå§‹åŒ–å¤±è´¥: " + pluginName, e);
        }
        
        // æ³¨å†ŒAPIæ‰©å±•ç‚¹
        for (ApiExtension extension : plugin.getApiExtensions()) {
            apiExtensionRegistry.registerCustomApi(
                extension.getApiPath(),
                extension.getHandler()
            );
        }
        
        loadedPlugins.put(pluginName, plugin);
    }
    
    /**
     * å¯åŠ¨æ’ä»¶
     */
    public void startPlugin(String pluginName) throws PluginException {
        Plugin plugin = loadedPlugins.get(pluginName);
        if (plugin == null) {
            throw new PluginException("æ’ä»¶æœªåŠ è½½: " + pluginName);
        }
        
        log.info("å¯åŠ¨æ’ä»¶: {}", pluginName);
        plugin.start();
        pluginStates.put(pluginName, PluginState.STARTED);
    }
    
    /**
     * åœæ­¢æ’ä»¶
     */
    public void stopPlugin(String pluginName) throws PluginException {
        Plugin plugin = loadedPlugins.get(pluginName);
        if (plugin == null) {
            throw new PluginException("æ’ä»¶æœªåŠ è½½: " + pluginName);
        }
        
        log.info("åœæ­¢æ’ä»¶: {}", pluginName);
        plugin.stop();
        pluginStates.put(pluginName, PluginState.STOPPED);
    }
    
    /**
     * å¸è½½æ’ä»¶
     */
    public void unloadPlugin(String pluginName) throws PluginException {
        Plugin plugin = loadedPlugins.get(pluginName);
        if (plugin == null) {
            throw new PluginException("æ’ä»¶æœªåŠ è½½: " + pluginName);
        }
        
        // æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ’ä»¶ä¾èµ–æ­¤æ’ä»¶
        for (Plugin other : loadedPlugins.values()) {
            if (other.getDependencies().contains(pluginName)) {
                throw new PluginException(
                    String.format("æ’ä»¶ %s ä¾èµ–æ­¤æ’ä»¶ï¼Œæ— æ³•å¸è½½", other.getName())
                );
            }
        }
        
        // åœæ­¢æ’ä»¶
        if (pluginStates.get(pluginName) == PluginState.STARTED) {
            stopPlugin(pluginName);
        }
        
        loadedPlugins.remove(pluginName);
        pluginStates.remove(pluginName);
        
        log.info("æ’ä»¶å¸è½½æˆåŠŸ: {}", pluginName);
    }
    
    /**
     * è‡ªåŠ¨æ‰«æå¹¶åŠ è½½æ’ä»¶
     */
    @PostConstruct
    public void autoLoadPlugins() {
        Map<String, Plugin> plugins = applicationContext.getBeansOfType(Plugin.class);
        
        for (Plugin plugin : plugins.values()) {
            try {
                loadPlugin(plugin);
                startPlugin(plugin.getName());
            } catch (PluginException e) {
                log.error("åŠ è½½æ’ä»¶å¤±è´¥: {}", plugin.getName(), e);
            }
        }
    }
}

enum PluginState {
    INITIALIZED,
    STARTED,
    STOPPED,
    FAILED
}
```

---

## ğŸ¨ å‰ç«¯æ’ä»¶åŒ–è®¾è®¡

### åŠ¨æ€ç»„ä»¶åŠ è½½å™¨

```typescript
// ComponentLoader.ts
import { defineAsyncComponent } from 'vue'

/**
 * æ’ä»¶ç»„ä»¶åŠ è½½å™¨
 */
export class ComponentLoader {
  private loadedComponents = new Map<string, Component>()
  private componentRegistry = new Map<string, ComponentDefinition>()
  
  /**
   * æ³¨å†Œç»„ä»¶
   */
  registerComponent(definition: ComponentDefinition) {
    this.componentRegistry.set(definition.componentId, definition)
  }
  
  /**
   * æ‰¹é‡æ³¨å†Œç»„ä»¶
   */
  registerComponents(definitions: ComponentDefinition[]) {
    definitions.forEach(def => this.registerComponent(def))
  }
  
  /**
   * åŠ è½½ç»„ä»¶
   */
  async loadComponent(componentId: string): Promise<Component> {
    // å¦‚æœå·²åŠ è½½ï¼Œç›´æ¥è¿”å›
    if (this.loadedComponents.has(componentId)) {
      return this.loadedComponents.get(componentId)!
    }
    
    // æŸ¥æ‰¾ç»„ä»¶å®šä¹‰
    const definition = this.componentRegistry.get(componentId)
    if (!definition) {
      throw new Error(`ç»„ä»¶ä¸å­˜åœ¨: ${componentId}`)
    }
    
    // åŠ¨æ€åŠ è½½ç»„ä»¶
    const component = await this.dynamicLoad(definition)
    this.loadedComponents.set(componentId, component)
    
    return component
  }
  
  /**
   * åŠ¨æ€åŠ è½½ç»„ä»¶
   */
  private async dynamicLoad(definition: ComponentDefinition): Promise<Component> {
    try {
      const module = await import(/* webpackMode: "lazy" */ definition.componentPath)
      return module.default || module[definition.componentName]
    } catch (error) {
      console.error(`åŠ è½½ç»„ä»¶å¤±è´¥: ${definition.componentPath}`, error)
      throw error
    }
  }
  
  /**
   * è·å–æ‰€æœ‰å¯ç”¨ç»„ä»¶
   */
  getAvailableComponents(): ComponentDefinition[] {
    return Array.from(this.componentRegistry.values())
  }
  
  /**
   * æ‰¹é‡é¢„åŠ è½½ç»„ä»¶
   */
  async preloadComponents(componentIds: string[]): Promise<void> {
    await Promise.all(componentIds.map(id => this.loadComponent(id)))
  }
}

interface ComponentDefinition {
  componentId: string
  componentPath: string
  componentName: string
  displayName: string
  version: string
  props?: Record<string, any>
  permissions?: string[]
}

// å•ä¾‹
export const componentLoader = new ComponentLoader()
```

### æ’ä»¶ç»„ä»¶åŒ…è£…å™¨

```vue
<!-- PluginComponentWrapper.vue -->
<template>
  <component
    :is="loadedComponent"
    v-if="loadedComponent"
    v-bind="mergedProps"
    @hook:mounted="onMounted"
  />
  <div v-else-if="loading" class="plugin-loading">
    <el-icon class="is-loading"><Loading /></el-icon>
    <span>åŠ è½½ä¸­...</span>
  </div>
  <div v-else class="plugin-error">
    <el-icon><CircleClose /></el-icon>
    <span>{{ errorMessage }}</span>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch, onMounted } from 'vue'
import { Loading, CircleClose } from '@element-plus/icons-vue'
import { componentLoader } from '@/utils/ComponentLoader'

interface Props {
  componentId: string
  props?: Record<string, any>
  permissions?: string[]
}

const props = withDefaults(defineProps<Props>(), {
  props: () => ({}),
  permissions: () => ([])
})

const emit = defineEmits<{
  (e: 'loaded'): void
  (e: 'error', error: Error): void
}>()

const loading = ref(true)
const error = ref<Error | null>(null)
const loadedComponent = ref<Component | null>(null)

const errorMessage = computed(() => {
  return error.value ? error.value.message : 'æœªçŸ¥é”™è¯¯'
})

const mergedProps = computed(() => {
  return {
    ...props.props,
    ...{ permissions: props.permissions }
  }
})

const loadComponent = async () => {
  loading.value = true
  error.value = null
  
  try {
    const component = await componentLoader.loadComponent(props.componentId)
    loadedComponent.value = component
    emit('loaded')
  } catch (err) {
    error.value = err as Error
    emit('error', err as Error)
  } finally {
    loading.value = false
  }
}

const onMounted = () => {
  console.log(`æ’ä»¶ç»„ä»¶å·²æŒ‚è½½: ${props.componentId}`)
}

watch(() => props.componentId, () => {
  loadComponent()
})

onMounted(() => {
  loadComponent()
})
</script>

<style scoped>
.plugin-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  color: #909399;
}

.plugin-loading .el-icon {
  margin-right: 8px;
}

.plugin-error {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  color: #f56c6c;
  background-color: #fef0f0;
  border-radius: 4px;
}

.plugin-error .el-icon {
  margin-right: 8px;
}
</style>
```

### åŠ¨æ€è¡¨å•å­—æ®µç»„ä»¶

```vue
<!-- DynamicFormField.vue -->
<template>
  <el-form-item
    :label="field.fieldName"
    :required="field.required"
    :prop="field.fieldId"
    :error="fieldErrors[field.fieldId]"
  >
    <!-- æ–‡æœ¬è¾“å…¥ -->
    <el-input
      v-if="field.fieldType === 'text'"
      v-model="fieldValue"
      :disabled="!field.editable || isViewMode"
      :placeholder="`è¯·è¾“å…¥${field.fieldName}`"
      @input="handleFieldChange"
    />
    
    <!-- æ•°å­—è¾“å…¥ -->
    <el-input-number
      v-else-if="field.fieldType === 'number'"
      v-model="fieldValue"
      :disabled="!field.editable || isViewMode"
      :placeholder="`è¯·è¾“å…¥${field.fieldName}`"
      @input="handleFieldChange"
    />
    
    <!-- å°æ•°è¾“å…¥ -->
    <el-input-number
      v-else-if="field.fieldType === 'decimal'"
      v-model="fieldValue"
      :disabled="!field.editable || isViewMode"
      :precision="2"
      :step="0.01"
      :placeholder="`è¯·è¾“å…¥${field.fieldName}`"
      @input="handleFieldChange"
    />
    
    <!-- æ—¥æœŸé€‰æ‹© -->
    <el-date-picker
      v-else-if="field.fieldType === 'date'"
      v-model="fieldValue"
      :disabled="!field.editable || isViewMode"
      type="date"
      :placeholder="`è¯·é€‰æ‹©${field.fieldName}`"
      value-format="YYYY-MM-DD"
      @change="handleFieldChange"
    />
    
    <!-- ä¸‹æ‹‰é€‰æ‹© -->
    <el-select
      v-else-if="field.fieldType === 'select'"
      v-model="fieldValue"
      :disabled="!field.editable || isViewMode"
      :placeholder="`è¯·é€‰æ‹©${field.fieldName}`"
      @change="handleFieldChange"
      filterable
    >
      <el-option
        v-for="option in selectOptions"
        :key="option.value"
        :label="option.label"
        :value="option.value"
      />
    </el-select>
    
    <!-- æ–‡æœ¬åŸŸ -->
    <el-input
      v-else-if="field.fieldType === 'textarea'"
      v-model="fieldValue"
      type="textarea"
      :disabled="!field.editable || isViewMode"
      :placeholder="`è¯·è¾“å…¥${field.fieldName}`"
      :rows="3"
      @input="handleFieldChange"
    />
    
    <!-- æ–‡ä»¶ä¸Šä¼  -->
    <FileUploader
      v-else-if="field.fieldType === 'fileUpload'"
      v-model="fieldValue"
      :disabled="!field.editable || isViewMode"
      :max-files="field.config?.maxFiles"
      :max-size="field.config?.maxSize"
      :accept-types="field.config?.acceptTypes"
      @change="handleFileChange"
    />
    
    <!-- åŠ¨æ€è¡¨æ ¼ -->
    <DynamicTable
      v-else-if="field.fieldType === 'dynamicTable'"
      v-model="fieldValue"
      :columns="field.columns"
      :disabled="!field.editable || isViewMode"
      @change="handleFieldChange"
    />
    
    <!-- è‡ªå®šä¹‰å­—æ®µï¼ˆé€šè¿‡æ’ä»¶æ³¨å†Œï¼‰ -->
    <PluginComponentWrapper
      v-else
      :component-id="`field-${field.fieldType}`"
      :props="{
        field,
        value: fieldValue,
        disabled: !field.editable || isViewMode,
        onChange: handleFieldChange
      }"
    />
  </el-form-item>
</template>

<script setup lang="ts">
import { ref, computed, watch, onMounted } from 'vue'
import { useField } from '@/composables/useField'
import FileUploader from '@/components/FileUploader.vue'
import DynamicTable from '@/components/DynamicTable.vue'
import PluginComponentWrapper from '@/components/PluginComponentWrapper.vue'

interface Props {
  field: FieldDefinition
  modelValue: any
  mode?: 'view' | 'edit' | 'approve'
}

const props = withDefaults(defineProps<Props>(), {
  mode: 'edit'
})

const emit = defineEmits<{
  (e: 'update:modelValue', value: any): void
  (e: 'change', fieldId: string, value: any): void
}>()

// é€‰æ‹©æ¡†é€‰é¡¹
const selectOptions = ref<SelectOption[]>([])

// å­—æ®µå€¼
const fieldValue = computed({
  get: () => props.modelValue,
  set: (value) => emit('update:modelValue', value)
})

// å­—æ®µé”™è¯¯
const fieldErrors = ref<Record<string, string[]>>({})

// æ˜¯å¦æ˜¯æŸ¥çœ‹æ¨¡å¼
const isViewMode = computed(() => props.mode === 'view')

// åŠ è½½é€‰æ‹©æ¡†é€‰é¡¹
const loadSelectOptions = async () => {
  if (props.field.fieldType !== 'select' || !props.field.dataSource) {
    return
  }
  
  const dataSource = props.field.dataSource
  if (dataSource.type === 'api') {
    // ä»APIåŠ è½½é€‰é¡¹
    try {
      const response = await fetch(dataSource.url)
      const data = await response.json()
      selectOptions.value = data.map((item: any) => ({
        value: item[dataSource.valueField],
        label: item[dataSource.labelField]
      }))
    } catch (error) {
      console.error('åŠ è½½é€‰æ‹©æ¡†é€‰é¡¹å¤±è´¥:', error)
    }
  } else if (dataSource.type === 'static') {
    // é™æ€é€‰é¡¹
    selectOptions.value = dataSource.options || []
  }
}

// å­—æ®µå˜æ›´å¤„ç†
const handleFieldChange = (value: any) => {
  fieldValue.value = value
  emit('change', props.field.fieldId, value)
  
  // éªŒè¯å­—æ®µ
  validateField(value)
}

// æ–‡ä»¶å˜æ›´å¤„ç†
const handleFileChange = (files: File[]) => {
  fieldValue.value = files
  emit('change', props.field.fieldId, files)
}

// å­—æ®µéªŒè¯
const validateField = (value: any) => {
  const errors: string[] = []
  
  // å¿…å¡«éªŒè¯
  if (props.field.required && !value) {
    errors.push(`${props.field.fieldName}ä¸èƒ½ä¸ºç©º`)
    fieldErrors.value[props.field.fieldId] = errors
    return
  }
  
  // ç±»å‹éªŒè¯
  if (props.field.validations) {
    props.field.validations.forEach(validation => {
      const error = runValidation(validation, value)
      if (error) errors.push(error)
    })
  }
  
  fieldErrors.value[props.field.fieldId] = errors
}

// è¿è¡ŒéªŒè¯è§„åˆ™
const runValidation = (validation: Validation, value: any) => {
  switch (validation.type) {
    case 'pattern':
      return new RegExp(validation.pattern).test(value)
        ? null
        : validation.message
    
    case 'min':
      return value >= validation.value ? null : validation.message
    
    case 'max':
      return value <= validation.value ? null : validation.message
    
    default:
      return null
  }
}

// ç›‘å¬å­—æ®µå®šä¹‰å˜åŒ–
watch(() => props.field, () => {
  if (props.field.fieldType === 'select') {
    loadSelectOptions()
  }
}, { deep: true })

onMounted(() => {
  loadSelectOptions()
})
</script>

<script lang="ts">
interface FieldDefinition {
  fieldId: string
  fieldName: string
  fieldType: string
  required: boolean
  editable: boolean
  defaultValue?: any
  validations?: Validation[]
  dataSource?: DataSource
  config?: any
  columns?: FieldDefinition[]
}

interface Validation {
  type: string
  pattern?: string
  value?: any
  message: string
}

interface DataSource {
  type: 'api' | 'static'
  url?: string
  valueField?: string
  labelField?: string
  options?: SelectOption[]
}

interface SelectOption {
  value: any
  label: string
}
</script>
```

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### é˜¶æ®µ1: å·¥ä½œæµå¼•æ“é‡æ„ï¼ˆ2-3å‘¨ï¼‰

**ç›®æ ‡**: å°†Flowableç¡¬ç¼–ç é€»è¾‘è§£è€¦ï¼Œå®ç°é…ç½®åŒ–ã€æ’ä»¶åŒ–

**ä»»åŠ¡æ¸…å•**:
1. [ ] è®¾è®¡å¹¶å®ç°WorkflowEngineæŠ½è±¡æ¥å£
2. [ ] å®ç°FlowableWorkflowEngineé€‚é…å™¨
3. [ ] è®¾è®¡æµç¨‹å®šä¹‰JSON Schema
4. [ ] å®ç°æµç¨‹å®šä¹‰ç®¡ç†API
5. [ ] å®ç°æµç¨‹è®¾è®¡å™¨å‰ç«¯ç»„ä»¶
6. [ ] å®ç°WorkflowListeneræœºåˆ¶
7. [ ] å®ç°ä¸šåŠ¡çŠ¶æ€åŒæ­¥æ’ä»¶
8. [ ] å®ç°åŠ¨æ€å®¡æ‰¹äººæœåŠ¡
9. [ ] è¿ç§»ç°æœ‰BPMNæµç¨‹åˆ°JSONé…ç½®
10. [ ] ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### é˜¶æ®µ2: è¡¨å•å¼•æ“é‡æ„ï¼ˆ2-3å‘¨ï¼‰

**ç›®æ ‡**: å®ç°åŠ¨æ€è¡¨å•é…ç½®ã€æ¸²æŸ“ã€éªŒè¯

**ä»»åŠ¡æ¸…å•**:
1. [ ] è®¾è®¡è¡¨å•å®šä¹‰JSON Schema
2. [ ] å®ç°è¡¨å•é…ç½®ç®¡ç†API
3. [ ] å®ç°åŠ¨æ€è¡¨å•æ¸²æŸ“å¼•æ“
4. [ ] å®ç°å­—æ®µç±»å‹ç»„ä»¶åº“
5. [ ] å®ç°è¡¨å•éªŒè¯å¼•æ“
6. [ ] å®ç°è¡¨å•è§„åˆ™å¼•æ“
7. [ ] è¿ç§»ç°æœ‰è¡¨å•åˆ°JSONé…ç½®
8. [ ] å®ç°è¡¨å•è®¾è®¡å™¨å‰ç«¯ç»„ä»¶
9. [ ] ç¼–å†™è¡¨å•ç»„ä»¶å•å…ƒæµ‹è¯•
10. [ ] é›†æˆè¡¨å•å¼•æ“ä¸å·¥ä½œæµå¼•æ“

### é˜¶æ®µ3: APIæ‰©å±•ç‚¹å®ç°ï¼ˆ2å‘¨ï¼‰

**ç›®æ ‡**: å®ç°APIé’©å­æœºåˆ¶ï¼Œæ”¯æŒæ’ä»¶æ‰©å±•

**ä»»åŠ¡æ¸…å•**:
1. [ ] è®¾è®¡ApiExtensionRegistryæ¥å£
2. [ ] å®ç°APIé’©å­æœºåˆ¶
3. [ ] å®ç°APIæ‹¦æˆªå™¨
4. [ ] å®ç°æ•°æ®è½¬æ¢å™¨æœºåˆ¶
5. [ ] ç¼–å†™æ‰©å±•ç‚¹ä½¿ç”¨ç¤ºä¾‹
6. [ ] å®ç°è‡ªå®šä¹‰APIæ³¨å†Œ
7. [ ] ç¼–å†™å•å…ƒæµ‹è¯•
8. [ ] æ–‡æ¡£åŒ–æ‰©å±•ç‚¹ä½¿ç”¨æ–¹æ³•

### é˜¶æ®µ4: æ’ä»¶åŠ è½½æœºåˆ¶ï¼ˆ2å‘¨ï¼‰

**ç›®æ ‡**: å®ç°æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†

**ä»»åŠ¡æ¸…å•**:
1. [ ] è®¾è®¡Pluginæ¥å£
2. [ ] å®ç°PluginManager
3. [ ] å®ç°æ’ä»¶è‡ªåŠ¨åŠ è½½
4. [ ] å®ç°æ’ä»¶ä¾èµ–ç®¡ç†
5. [ ] å®ç°æ’ä»¶ç‰ˆæœ¬ç®¡ç†
6. [ ] å®ç°æ’ä»¶çƒ­åŠ è½½/å¸è½½
7. [ ] ç¼–å†™æ’ä»¶å¼€å‘æŒ‡å—
8. [ ] å®ç°ç¤ºä¾‹æ’ä»¶

### é˜¶æ®µ5: å‰ç«¯ç»„ä»¶é‡æ„ï¼ˆ3-4å‘¨ï¼‰

**ç›®æ ‡**: å®ç°åŠ¨æ€ç»„ä»¶åŠ è½½ã€åŠ¨æ€è¡¨å•æ¸²æŸ“

**ä»»åŠ¡æ¸…å•**:
1. [ ] å®ç°ComponentLoader
2. [ ] å®ç°PluginComponentWrapper
3. [ ] å®ç°DynamicFormFieldç»„ä»¶
4. [ ] å®ç°å„ç§å­—æ®µç±»å‹ç»„ä»¶
5. [ ] å®ç°åŠ¨æ€è¡¨å•æ¸²æŸ“å™¨
6. [ ] å®ç°è¡¨å•éªŒè¯é€»è¾‘
7. [ ] å®ç°è¡¨å•è§„åˆ™å¼•æ“å‰ç«¯
8. [ ] å®ç°ç»„ä»¶é¢„åŠ è½½
9. [ ] ç¼–å†™ç»„ä»¶å•å…ƒæµ‹è¯•
10. [ ] é›†æˆå‰åç«¯æ’ä»¶æœºåˆ¶

### é˜¶æ®µ6: æ ¸å¿ƒä¸šåŠ¡æ’ä»¶è¿ç§»ï¼ˆ4-6å‘¨ï¼‰

**ç›®æ ‡**: å°†ç°æœ‰ä¸šåŠ¡åŠŸèƒ½è¿ç§»åˆ°æ’ä»¶æ¶æ„

**ä»»åŠ¡æ¸…å•**:
1. [ ] å®ç°æŠ¥é”€æ’ä»¶
   - [ ] æŠ¥é”€API
   - [ ] æŠ¥é”€Service
   - [ ] æŠ¥é”€Entity
   - [ ] æŠ¥é”€å‰ç«¯ç»„ä»¶
2. [ ] å®ç°å€Ÿæ¬¾æ’ä»¶
   - [ ] å€Ÿæ¬¾API
   - [ ] å€Ÿæ¬¾Service
   - [ ] å€Ÿæ¬¾Entity
   - [ ] å€Ÿæ¬¾å‰ç«¯ç»„ä»¶
3. [ ] å®ç°è¿˜æ¬¾æ’ä»¶
   - [ ] è¿˜æ¬¾API
   - [ ] è¿˜æ¬¾Service
   - [ ] è¿˜æ¬¾Entity
   - [ ] è¿˜æ¬¾å‰ç«¯ç»„ä»¶
4. [ ] å®ç°å·¥ä½œæµè®¾è®¡å™¨æ’ä»¶
   - [ ] BPMNæ¨¡å‹å™¨é›†æˆ
   - [ ] æµç¨‹å¯è§†åŒ–ç»„ä»¶
   - [ ] æµç¨‹éƒ¨ç½²åŠŸèƒ½
5. [ ] ç¼–å†™è¿ç§»æ–‡æ¡£
6. [ ] ç¼–å†™æ’ä»¶å¼€å‘æŒ‡å—

### é˜¶æ®µ7: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ2-3å‘¨ï¼‰

**ä»»åŠ¡æ¸…å•**:
1. [ ] ç¼–å†™é›†æˆæµ‹è¯•
2. [ ] æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
3. [ ] å®‰å…¨æµ‹è¯•
4. [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•
5. [ ] æ–‡æ¡£å®Œå–„
6. [ ] éƒ¨ç½²å’Œä¸Šçº¿

---

## ğŸ¯ é‡æ„æ•ˆæœé¢„æœŸ

### ä»£ç è´¨é‡æå‡

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | æå‡ |
|------|------|------|------|
| ä»£ç è€¦åˆåº¦ | é«˜ | ä½ | â†“ 70% |
| å¯æ‰©å±•æ€§ | ä½ | é«˜ | â†‘ 200% |
| é‡å¤ä»£ç  | å¤š | å°‘ | â†“ 60% |
| æµ‹è¯•è¦†ç›–ç‡ | 30% | 80% | â†‘ 167% |

### åŠŸèƒ½çµæ´»æ€§æå‡

- âœ… æµç¨‹å®šä¹‰å¯é€šè¿‡JSONé…ç½®ï¼ŒéæŠ€æœ¯å¯ä¿®æ”¹
- âœ… è¡¨å•å­—æ®µå¯é€šè¿‡é…ç½®åŠ¨æ€å¢å‡
- âœ… å®¡æ‰¹è§„åˆ™å¯çµæ´»è°ƒæ•´
- âœ… æ”¯æŒè‡ªå®šä¹‰æ’ä»¶æ‰©å±•
- âœ… æ”¯æŒå¤šç§Ÿæˆ·ä¸ªæ€§åŒ–é…ç½®

### å¼€å‘æ•ˆç‡æå‡

| åœºæ™¯ | å½“å‰è€—æ—¶ | é‡æ„åè€—æ—¶ | æå‡ |
|------|---------|-----------|------|
| æ–°å¢æŠ¥é”€ç±»å‹ | 2-3å¤© | 4å°æ—¶ | â†“ 83% |
| ä¿®æ”¹å®¡æ‰¹æµç¨‹ | 1-2å¤© | 30åˆ†é’Ÿ | â†“ 94% |
| æ–°å¢è¡¨å•å­—æ®µ | 1å¤© | 10åˆ†é’Ÿ | â†“ 98% |
| å¼€å‘è‡ªå®šä¹‰æ’ä»¶ | ä¸æ”¯æŒ | 1-2å¤© | æ–°å¢èƒ½åŠ› |

---

## ğŸ”‘ å…³é”®æŠ€æœ¯å†³ç­–

### 1. å·¥ä½œæµå¼•æ“é€‰æ‹©

**æ¨è**: ä¿æŒFlowableï¼Œä½†å°è£…ä¸ºæŠ½è±¡æ¥å£

**ç†ç”±**:
- Flowableå·²ç»é›†æˆï¼Œè¿ç§»æˆæœ¬é«˜
- é€šè¿‡æŠ½è±¡æ¥å£å¯éšæ—¶åˆ‡æ¢å…¶ä»–å¼•æ“
- FlowableåŠŸèƒ½å®Œå–„ï¼Œæ»¡è¶³å½“å‰éœ€æ±‚

**å¤‡é€‰**: Camunda 8ã€Temporal.io

### 2. è¡¨å•å¼•æ“

**æ¨è**: è‡ªç ”åŠ¨æ€è¡¨å•å¼•æ“ï¼ˆJSONé…ç½®é©±åŠ¨ï¼‰

**ç†ç”±**:
- å®Œå…¨å¯æ§ï¼Œå¯å®šåˆ¶
- ä¸ä¸šåŠ¡æ·±åº¦é›†æˆ
- æ”¯æŒå‰åç«¯ä¸€è‡´é…ç½®

**å¤‡é€‰**: Form.ioã€SurveyJS

### 3. æ’ä»¶åŠ è½½æœºåˆ¶

**æ¨è**: Spring Beanè‡ªåŠ¨æ‰«æ + æ‰‹åŠ¨æ³¨å†Œ

**ç†ç”±**:
- ç®€å•æ˜“ç”¨
- ä¸Springç”Ÿæ€è‰¯å¥½é›†æˆ
- æ”¯æŒçƒ­åŠ è½½

**å¤‡é€‰**: OSGiã€æ¨¡å—åŒ–Java

### 4. å‰ç«¯ç»„ä»¶åŠ è½½

**æ¨è**: Vue 3 defineAsyncComponent + åŠ¨æ€å¯¼å…¥

**ç†ç”±**:
- Vue 3åŸç”Ÿæ”¯æŒ
- Webpackä»£ç åˆ†å‰²
- æ€§èƒ½ä¼˜ç§€

**å¤‡é€‰**: SystemJSã€å¾®å‰ç«¯

---

## ğŸ“Š æ¶æ„å¯¹æ¯”

| ç»´åº¦ | å½“å‰æ¶æ„ | æ’ä»¶åŒ–æ¶æ„ | æ”¹è¿› |
|------|---------|-----------|------|
| ä»£ç è€¦åˆ | é«˜ï¼ˆç¡¬ç¼–ç ï¼‰ | ä½ï¼ˆé…ç½®é©±åŠ¨ï¼‰ | â†“ 70% |
| æ‰©å±•æ€§ | ä½ï¼ˆéœ€ä¿®æ”¹ä»£ç ï¼‰ | é«˜ï¼ˆæ’ä»¶æ‰©å±•ï¼‰ | â†‘ 200% |
| çµæ´»æ€§ | ä½ï¼ˆæµç¨‹å›ºå®šï¼‰ | é«˜ï¼ˆåŠ¨æ€é…ç½®ï¼‰ | â†‘ 300% |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ | â†“ 60% |
| å¼€å‘æ•ˆç‡ | ä¸­ | é«˜ | â†‘ 100% |
| å­¦ä¹ æ›²çº¿ | é™¡ï¼ˆéœ€æ‡‚Flowableï¼‰ | å¹³ï¼ˆé…ç½®åŒ–ï¼‰ | â†“ 50% |
| å¤šç§Ÿæˆ·æ”¯æŒ | åŸºç¡€ | å®Œå–„ï¼ˆæ’ä»¶éš”ç¦»ï¼‰ | â†‘ 100% |
| è‡ªå®šä¹‰èƒ½åŠ› | æ—  | å¼ºï¼ˆæ’ä»¶æœºåˆ¶ï¼‰ | æ–°å¢ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0-draft  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-24  
**åˆ†æçŠ¶æ€**: ç­‰å¾…æ¢ç´¢agentsç»“æœè¡¥å……

---

## ğŸ”§ Librarian Agenté—®é¢˜è¯´æ˜

### é—®é¢˜åŸå› 

**é”™è¯¯ä¿¡æ¯**: `ProviderModelNotFoundError`

**åŸå› åˆ†æ**:
- Librarian agentæ˜¯ç”¨äºç ”ç©¶å¤–éƒ¨åº“æ–‡æ¡£çš„ä¸“ç”¨agent
- è¯¥agentéœ€è¦è®¿é—®å¤–éƒ¨APIå’Œæ–‡æ¡£æº
- å¯èƒ½çš„å¤±è´¥åŸå› ï¼š
  1. ç½‘ç»œè¿æ¥é—®é¢˜
  2. APIå¯†é’¥æˆ–é…ç½®ç¼ºå¤±
  3. æœåŠ¡ç«¯æš‚æ—¶ä¸å¯ç”¨
  4. ä¾èµ–çš„å¤–éƒ¨æœåŠ¡å˜æ›´

### è§£å†³æ–¹æ¡ˆ

**æ›¿ä»£æ–¹æ¡ˆ**ï¼š
1. âœ… ä½¿ç”¨Explore agentsç ”ç©¶å¼€æºé¡¹ç›®
2. âœ… ç›´æ¥ä½¿ç”¨WebSearchå·¥å…·æœç´¢æ–‡æ¡£
3. âœ… ä½¿ç”¨Grepæœç´¢å·¥å…·ç ”ç©¶ä»£ç æ¨¡å¼
4. âœ… å‚è€ƒå®˜æ–¹æ–‡æ¡£å’ŒGitHubé¡¹ç›®

**å½“å‰çŠ¶æ€**:
- å·²å¯åŠ¨3ä¸ªExplore agentsæ›¿ä»£å¤±è´¥çš„2ä¸ªLibrarian agents
- è¿™äº›agentså¯ä»¥è®¿é—®ä»£ç åº“å’Œæ–‡æ¡£ï¼ŒåŠŸèƒ½ç±»ä¼¼
- ä¸å½±å“æ•´ä½“åˆ†æå’Œè®¾è®¡å·¥ä½œ

---


---

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜

### æ–°ä»£ç å­˜æ”¾ä½ç½®

```
srcnew/
â”œâ”€â”€ backend/                    # æ–°ç‰ˆæœ¬åç«¯ä»£ç 
â”‚   â”œâ”€â”€ docs/                   # åç«¯è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ pom.xml                 # Maven é…ç½®
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main/
â”‚       â”‚   â”œâ”€â”€ java/com/fs/
â”‚       â”‚   â”‚   â”œâ”€â”€ plugin/      # æ’ä»¶ç³»ç»Ÿ
â”‚       â”‚   â”‚   â”œâ”€â”€ workflow/    # å·¥ä½œæµå¼•æ“
â”‚       â”‚   â”‚   â”œâ”€â”€ form/        # è¡¨å•å¼•æ“
â”‚       â”‚   â”‚   â”œâ”€â”€ api/         # API æ‰©å±•ç‚¹
â”‚       â”‚   â”‚   â””â”€â”€ config/     # é…ç½®ç±»
â”‚       â”‚   â””â”€â”€ resources/
â”‚       â”‚       â”œâ”€â”€ processes/    # æµç¨‹å®šä¹‰(JSON)
â”‚       â”‚       â”œâ”€â”€ forms/        # è¡¨å•é…ç½®(JSON)
â”‚       â”‚       â””â”€â”€ config/      # é…ç½®æ–‡ä»¶
â”‚       â””â”€â”€ test/
â”‚           â””â”€â”€ java/com/fs/     # æµ‹è¯•ä»£ç 
â”‚
â”œâ”€â”€ frontend-pc/               # æ–°ç‰ˆæœ¬PCç«¯å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ docs/                   # å‰ç«¯è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ api/                 # API æ¥å£
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ workflow/       # å·¥ä½œæµç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ form/           # è¡¨å•ç»„ä»¶
â”‚       â”‚   â””â”€â”€ plugin/         # æ’ä»¶ç»„ä»¶
â”‚       â”œâ”€â”€ views/
â”‚       â”‚   â”œâ”€â”€ workflow/       # å·¥ä½œæµé¡µé¢
â”‚       â”‚   â”œâ”€â”€ form/           # è¡¨å•é¡µé¢
â”‚       â”‚   â””â”€â”€ plugin/         # æ’ä»¶é¡µé¢
â”‚       â”œâ”€â”€ stores/              # Pinia çŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ assets/              # é™æ€èµ„æº
â”‚
â”œâ”€â”€ mobile/                     # æ–°ç‰ˆæœ¬ç§»åŠ¨ç«¯å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ docs/                   # ç§»åŠ¨ç«¯è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ api/
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ views/
â”‚       â”œâ”€â”€ stores/
â”‚       â”œâ”€â”€ utils/
â”‚       â””â”€â”€ assets/
â”‚
â””â”€â”€ shared/                     # å…±äº«ä»£ç 
    â”œâ”€â”€ docs/                   # å…±äº«è®¾è®¡æ–‡æ¡£
    â”œâ”€â”€ scripts/                # å…±äº«è„šæœ¬
    â””â”€â”€ config/                 # å…±äº«é…ç½®
```

### æ—§ä»£ç ä½ç½®
- `backend/` - å½“å‰åç«¯ä»£ç ï¼ˆä¿æŒä¸å˜ï¼Œç”¨äºå‚è€ƒï¼‰
- `frontend-pc/` - å½“å‰å‰ç«¯ä»£ç ï¼ˆä¿æŒä¸å˜ï¼Œç”¨äºå‚è€ƒï¼‰

---

## ğŸ’¾ æ•°æ®åº“è¿ç§»ä¿¡æ¯

### åŸç³»ç»Ÿæ•°æ®åº“

**æ•°æ®åº“**: `fs_enabling` (MySQL)

**è¿æ¥ä¿¡æ¯**:
- Host: localhost
- Port: 3306 (é»˜è®¤)
- Database: fs_enabling
- ç”¨æˆ·å: root (é…ç½®æ–‡ä»¶ä¸­)
- å¯†ç : iWhale@2023

**æ•°æ®å†…å®¹**:
- ç”¨æˆ·æ•°æ®
- ç»„ç»‡æ¶æ„
- æŠ¥é”€å•æ® (862 æ¡)
- å€Ÿæ¬¾è®°å½• (13 æ¡)
- è¿˜æ¬¾è®°å½• (7 æ¡)
- å®¡æ‰¹å†å²
- æƒé™é…ç½®
- åŸºç¡€æ•°æ®ï¼ˆå¸ç§ã€æ±‡ç‡ã€è´¹ç”¨ç±»å‹ç­‰ï¼‰

### æ–°ç³»ç»Ÿæ•°æ®åº“

**æ•°æ®åº“**: `new_fs` (PostgreSQL)

**è¿æ¥ä¿¡æ¯** (å½“å‰é…ç½®):
- Host: localhost
- Port: 5432
- Database: new_fs
- ç”¨æˆ·å: heyake
- å¯†ç : (ç©º)

### æ•°æ®è¿ç§»ç­–ç•¥

#### é˜¶æ®µ1: æ•°æ®åˆ†æï¼ˆ1å‘¨ï¼‰
- [ ] åˆ†æ fs_enabling æ•°æ®åº“ç»“æ„
- [ ] å¯¹æ¯”æ–°æ—§æ•°æ®æ¨¡å‹å·®å¼‚
- [ ] è¯†åˆ«éœ€è¦è½¬æ¢çš„æ•°æ®ç±»å‹
- [ ] ç”Ÿæˆæ•°æ®å­—å…¸æ–‡æ¡£

#### é˜¶æ®µ2: æ•°æ®æ¸…æ´—ï¼ˆ2å‘¨ï¼‰
- [ ] æ¸…ç†é‡å¤æ•°æ®
- [ ] ä¿®å¤æ•°æ®ä¸ä¸€è‡´
- [ ] æ ‡å‡†åŒ–æ•°æ®æ ¼å¼
- [ ] è¡¥å……ç¼ºå¤±æ•°æ®

#### é˜¶æ®µ3: æ•°æ®è½¬æ¢è„šæœ¬ï¼ˆ3å‘¨ï¼‰
- [ ] ç¼–å†™ MySQL åˆ° PostgreSQL æ•°æ®ç±»å‹æ˜ å°„
- [ ] ç¼–å†™æ•°æ®è½¬æ¢é€»è¾‘
- [ ] å¤„ç†å¤šç§Ÿæˆ·æ•°æ®è¿ç§»ï¼ˆtenant_id åˆ†é…ï¼‰
- [ ] å¤„ç†å·¥ä½œæµå®ä¾‹è¿ç§»

#### é˜¶æ®µ4: æ•°æ®éªŒè¯ï¼ˆ1å‘¨ï¼‰
- [ ] éªŒè¯æ•°æ®å®Œæ•´æ€§
- [ ] éªŒè¯ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§
- [ ] éªŒè¯æƒé™å…³ç³»
- [ ] æ€§èƒ½æµ‹è¯•

#### é˜¶æ®µ5: æ•°æ®å‰²æ¥ï¼ˆ1å¤©ï¼‰
- [ ] å¤‡ä»½æ—§ç³»ç»Ÿæ•°æ®
- [ ] æ‰§è¡Œæ•°æ®è¿ç§»è„šæœ¬
- [ ] éªŒè¯æ–°ç³»ç»Ÿæ•°æ®
- [ ] åˆ‡æ¢ç³»ç»Ÿ
- [ ] ç›‘æ§è¿è¡ŒçŠ¶æ€

### å…³é”®è¿ç§»æ³¨æ„äº‹é¡¹

1. **ç§Ÿæˆ·IDåˆ†é…**:
   - Company A: tenant_id = 1
   - Company B: tenant_id = 2

2. **ç”¨æˆ·å¯†ç å¤„ç†**:
   - æ—§ç³»ç»Ÿä½¿ç”¨ Shiro MD5 åŠ å¯†
   - æ–°ç³»ç»Ÿä½¿ç”¨ BCrypt
   - éœ€è¦é‡æ–°ç”Ÿæˆå¯†ç å“ˆå¸Œæˆ–è¦æ±‚ç”¨æˆ·é‡ç½®å¯†ç 

3. **å·¥ä½œæµå®ä¾‹è¿ç§»**:
   - è¿ç§» Activiti æµç¨‹å®ä¾‹åˆ° Flowable
   - ä¿ç•™å®¡æ‰¹å†å²
   - ä¿ç•™æµç¨‹çŠ¶æ€

4. **é™„ä»¶æ–‡ä»¶è¿ç§»**:
   - ä»æ—§ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿè¿ç§»åˆ° MinIO
   - æ›´æ–°æ–‡ä»¶è·¯å¾„

5. **å¤–é”®å…³ç³»**:
   - æ‰€æœ‰å¤–é”®å¿…é¡»åŒ…å« tenant_id
   - éœ€è¦åœ¨è¿ç§»æ—¶éªŒè¯æ•°æ®ä¸€è‡´æ€§

### æ•°æ®è¿ç§»è„šæœ¬ä½ç½®

**å­˜æ”¾ä½ç½®**: `srcnew/shared/scripts/migration/`

**è„šæœ¬æ–‡ä»¶**:
- `01-analyze-old-schema.sql` - åˆ†ææ—§æ•°æ®åº“ç»“æ„
- `02-clean-data.sql` - æ•°æ®æ¸…æ´—è„šæœ¬
- `03-convert-types.sql` - æ•°æ®ç±»å‹è½¬æ¢
- `04-migrate-users.sql` - ç”¨æˆ·æ•°æ®è¿ç§»
- `05-migrate-org.sql` - ç»„ç»‡æ•°æ®è¿ç§»
- `06-migrate-trans.sql` - æŠ¥é”€å•æ®è¿ç§»
- `07-migrate-loan.sql` - å€Ÿæ¬¾æ•°æ®è¿ç§»
- `08-migrate-repayment.sql` - è¿˜æ¬¾æ•°æ®è¿ç§»
- `09-migrate-workflow.sql` - å·¥ä½œæµæ•°æ®è¿ç§»
- `10-validate-data.sql` - æ•°æ®éªŒè¯
- `11-migrate-attachments.sh` - é™„ä»¶æ–‡ä»¶è¿ç§»è„šæœ¬

---

## ğŸ“ è®¾è®¡æ–‡æ¡£ç®¡ç†

### è®¾è®¡æ–‡æ¡£æ¸…å•

| æ–‡æ¡£ | ä½ç½® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| é¡¹ç›®ä»£ç é€»è¾‘åˆ†æ | `.sisyphus/drafts/é¡¹ç›®ä»£ç é€»è¾‘åˆ†æè‰ç¨¿.md` | âœ… å®Œæˆ | ä»£ç ç»“æ„å’Œæ¶æ„åˆ†æ |
| æ’ä»¶åŒ–æ¶æ„é‡æ„æ–¹æ¡ˆ | `.sisyphus/drafts/æ’ä»¶åŒ–æ¶æ„é‡æ„æ–¹æ¡ˆ.md` | â³ è¿›è¡Œä¸­ | è¯¦ç»†é‡æ„æ–¹æ¡ˆ |
| æ•°æ®è¿ç§»è®¡åˆ’ | `.sisyphus/drafts/æ•°æ®è¿ç§»è®¡åˆ’.md` | ğŸ“‹ å¾…åˆ›å»º | æ•°æ®åº“è¿ç§»è¯¦ç»†æ–¹æ¡ˆ |
| APIè®¾è®¡è§„èŒƒ | `srcnew/backend/docs/api-design.md` | ğŸ“‹ å¾…åˆ›å»º | APIæ‰©å±•ç‚¹ä½¿ç”¨æ–‡æ¡£ |
| æ’ä»¶å¼€å‘æŒ‡å— | `srcnew/backend/docs/plugin-dev-guide.md` | ğŸ“‹ å¾…åˆ›å»º | æ’ä»¶å¼€å‘æ•™ç¨‹ |
| å‰ç«¯ç»„ä»¶å¼€å‘æŒ‡å— | `srcnew/frontend-pc/docs/component-dev-guide.md` | ğŸ“‹ å¾…åˆ›å»º | å‰ç«¯ç»„ä»¶å¼€å‘æ•™ç¨‹ |
| å·¥ä½œæµè®¾è®¡æŒ‡å— | `srcnew/shared/docs/workflow-design-guide.md` | ğŸ“‹ å¾…åˆ›å»º | æµç¨‹è®¾è®¡æ•™ç¨‹ |
| è¡¨å•é…ç½®æŒ‡å— | `srcnew/shared/docs/form-config-guide.md` | ğŸ“‹ å¾…åˆ›å»º | è¡¨å•é…ç½®æ•™ç¨‹ |

---

## ğŸ”„ å·¥ä½œæµç¨‹

### å½“å‰å·¥ä½œæµç¨‹

1. **è®¾è®¡é˜¶æ®µ** (å½“å‰)
   - âœ… åˆ†æç°æœ‰ä»£ç 
   - âœ… è¯†åˆ«é—®é¢˜å’Œæ”¹è¿›ç‚¹
   - âœ… è®¾è®¡æ–°æ¶æ„
   - â³ ç­‰å¾…æ¢ç´¢ agents å®Œæˆåˆ†æ
   - â³ è¡¥å……è¯¦ç»†è®¾è®¡
   - â³ ç”¨æˆ·å®¡é˜…

2. **å®¡é˜…é˜¶æ®µ** (å¾…å¼€å§‹)
   - ç”¨æˆ·å®¡é˜…è®¾è®¡æ–¹æ¡ˆ
   - æå‡ºä¿®æ”¹æ„è§
   - ç¡®è®¤æœ€ç»ˆæ–¹æ¡ˆ
   - åˆ¶å®šå®æ–½è®¡åˆ’

3. **å®æ–½é˜¶æ®µ** (å¾…ç¡®è®¤)
   - æ ¸å¿ƒå¹³å°å¼€å‘
   - æ’ä»¶ç³»ç»Ÿå¼€å‘
   - å‰ç«¯ç»„ä»¶å¼€å‘
   - å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

4. **æ•°æ®è¿ç§»é˜¶æ®µ** (å¾…ç¡®è®¤)
   - æ•°æ®åˆ†æ
   - æ•°æ®æ¸…æ´—
   - æ•°æ®è½¬æ¢
   - æ•°æ®éªŒè¯
   - æ•°æ®å‰²æ¥

5. **ä¸Šçº¿é˜¶æ®µ** (å¾…ç¡®è®¤)
   - éƒ¨ç½²æ–°ç³»ç»Ÿ
   - åˆ‡æ¢æ•°æ®
   - ç›‘æ§è¿è¡Œ
   - ç”¨æˆ·åŸ¹è®­

---

## ğŸ“Š è®¾è®¡å®¡é˜…æ¸…å•

### å¾…å®¡é˜…å†…å®¹

- [ ] **æ¶æ„è®¾è®¡**
  - [ ] æ’ä»¶åŒ–æ¶æ„æ˜¯å¦åˆç†
  - [ ] åˆ†å±‚æ˜¯å¦æ¸…æ™°
  - [ ] è€¦åˆåº¦æ˜¯å¦è¶³å¤Ÿä½
  - [ ] æ‰©å±•æ€§æ˜¯å¦è¶³å¤Ÿå¥½

- [ ] **å·¥ä½œæµæ”¹é€ **
  - [ ] å·¥ä½œæµå¼•æ“æŠ½è±¡æ˜¯å¦åˆç†
  - [ ] äº‹ä»¶é©±åŠ¨æœºåˆ¶æ˜¯å¦å®Œå–„
  - [ ] ä¸šåŠ¡çŠ¶æ€åŒæ­¥æ˜¯å¦æ­£ç¡®
  - [ ] åŠ¨æ€å®¡æ‰¹äººæœåŠ¡æ˜¯å¦çµæ´»

- [ ] **è¡¨å•å¼•æ“**
  - [ ] JSON Schema æ˜¯å¦å®Œæ•´
  - [ ] å­—æ®µç±»å‹æ˜¯å¦è¦†ç›–éœ€æ±‚
  - [ ] éªŒè¯è§„åˆ™æ˜¯å¦çµæ´»
  - [ ] åŠ¨æ€æ¸²æŸ“æ˜¯å¦é«˜æ•ˆ

- [ ] **API æ‰©å±•ç‚¹**
  - [ ] Hook æœºåˆ¶æ˜¯å¦å®Œå–„
  - [ ] è‡ªå®šä¹‰ API æ˜¯å¦æ˜“ç”¨
  - [ ] æ•°æ®è½¬æ¢æ˜¯å¦çµæ´»
  - [ ] ç‰ˆæœ¬æ§åˆ¶æ˜¯å¦åˆç†

- [ ] **æ’ä»¶ç³»ç»Ÿ**
  - [ ] æ’ä»¶æ¥å£æ˜¯å¦æ¸…æ™°
  - [ ] ä¾èµ–ç®¡ç†æ˜¯å¦å®Œå–„
  - [ ] ç”Ÿå‘½å‘¨æœŸæ˜¯å¦åˆç†
  - [ ] çƒ­åŠ è½½æ˜¯å¦æ”¯æŒ

- [ ] **å‰ç«¯ç»„ä»¶**
  - [ ] ç»„ä»¶åŒ–æ˜¯å¦å……åˆ†
  - [ ] åŠ¨æ€åŠ è½½æ˜¯å¦é«˜æ•ˆ
  - [ ] TypeScript ç±»å‹æ˜¯å¦å®Œå–„
  - [ ] æ€§èƒ½æ˜¯å¦ä¼˜åŒ–

- [ ] **æ•°æ®è¿ç§»**
  - [ ] è¿ç§»ç­–ç•¥æ˜¯å¦å®Œå–„
  - [ ] æ•°æ®ä¸€è‡´æ€§æ˜¯å¦ä¿è¯
  - [ ] é£é™©æ§åˆ¶æ˜¯å¦å……åˆ†
  - [ ] å›æ»šæ–¹æ¡ˆæ˜¯å¦å®Œå¤‡

---

## âœ… å·²å®Œæˆå·¥ä½œ

### ä»£ç åˆ†æ

- [x] é¡¹ç›®æ¦‚å†µåˆ†æ
- [x] æŠ€æœ¯æ ˆè¯†åˆ«
- [x] æ¶æ„åˆ†å±‚æ¢³ç†
- [x] åç«¯ä»£ç ç»“æ„åˆ†æ
- [x] å‰ç«¯ä»£ç ç»“æ„åˆ†æ
- [x] æ•°æ®åº“è®¾è®¡åˆ†æ
- [x] å·¥ä½œæµå®¡æ‰¹ç³»ç»Ÿé—®é¢˜è¯Šæ–­
- [x] API è®¾è®¡é—®é¢˜è¯†åˆ«
- [x] å‰ç«¯ç»„ä»¶é—®é¢˜è¯†åˆ«

### æ–‡æ¡£åˆ›å»º

- [x] é¡¹ç›®ä»£ç é€»è¾‘åˆ†æè‰ç¨¿
- [x] æ’ä»¶åŒ–æ¶æ„é‡æ„æ–¹æ¡ˆï¼ˆåˆç‰ˆï¼‰
- [x] srcnew ç›®å½•ç»“æ„åˆ›å»º
- [x] è®¾è®¡æ–‡æ¡£ç®¡ç†æ¸…å•

### å·¥ä½œå¯åŠ¨

- [x] 6ä¸ªæ¢ç´¢ agents å¯åŠ¨
  - [x] æ•´ä½“æ¶æ„å’Œä»£ç ç»„ç»‡
  - [x] æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å®ç°
  - [x] å¤šç§Ÿæˆ·éš”ç¦»å®ç°
  - [x] å·¥ä½œæµ Flowable é›†æˆ
  - [x] è®¤è¯æˆæƒæœºåˆ¶
  - [x] æ•°æ®åº“è®¾è®¡å’Œ API è®¾è®¡
- [x] 3ä¸ªæ¢ç´¢ agents å¯åŠ¨ï¼ˆæ›¿ä»£å¤±è´¥çš„librarian agentsï¼‰
  - [x] Spring Boot æ’ä»¶åŒ–æ¶æ„
  - [x] Vue 3 åŠ¨æ€è¡¨å•ç³»ç»Ÿ
  - [x] ç°ä»£å·¥ä½œæµå¼•æ“

### ç›®å½•åˆ›å»º

- [x] srcnew æ ¹ç›®å½•
- [x] backend å®Œæ•´ç›®å½•ç»“æ„
- [x] frontend-pc å®Œæ•´ç›®å½•ç»“æ„
- [x] mobile å®Œæ•´ç›®å½•ç»“æ„
- [x] shared å…±äº«ç›®å½•

---

## â³ å¾…å®Œæˆå·¥ä½œ

### è®¾è®¡æ–‡æ¡£

- [ ] è¡¥å……æ¢ç´¢ agents åˆ†æç»“æœ
- [ ] å®Œå–„å·¥ä½œæµå¼•æ“è®¾è®¡
- [ ] å®Œå–„è¡¨å•å¼•æ“è®¾è®¡
- [ ] å®Œå–„ API æ‰©å±•ç‚¹è®¾è®¡
- [ ] å®Œå–„æ’ä»¶ç³»ç»Ÿè®¾è®¡
- [ ] ç¼–å†™æ•°æ®è¿ç§»è¯¦ç»†æ–¹æ¡ˆ
- [ ] ç¼–å†™ API è®¾è®¡è§„èŒƒ
- [ ] ç¼–å†™æ’ä»¶å¼€å‘æŒ‡å—
- [ ] ç¼–å†™å‰ç«¯ç»„ä»¶å¼€å‘æŒ‡å—
- [ ] ç¼–å†™å·¥ä½œæµè®¾è®¡æŒ‡å—
- [ ] ç¼–å†™è¡¨å•é…ç½®æŒ‡å—

### ç¤ºä¾‹ä»£ç 

- [ ] å·¥ä½œæµå¼•æ“æŠ½è±¡æ¥å£å®ç°ç¤ºä¾‹
- [ ] è¡¨å•å¼•æ“æ ¸å¿ƒä»£ç ç¤ºä¾‹
- [ ] API æ‰©å±•ç‚¹ä½¿ç”¨ç¤ºä¾‹
- [ ] æ’ä»¶å¼€å‘ç¤ºä¾‹ï¼ˆæŠ¥é”€æ’ä»¶ï¼‰
- [ ] å‰ç«¯åŠ¨æ€ç»„ä»¶åŠ è½½ç¤ºä¾‹
- [ ] å‰ç«¯åŠ¨æ€è¡¨å•æ¸²æŸ“ç¤ºä¾‹

### æµ‹è¯•ä»£ç 

- [ ] å·¥ä½œæµå¼•æ“å•å…ƒæµ‹è¯•
- [ ] è¡¨å•å¼•æ“å•å…ƒæµ‹è¯•
- [ ] API æ‰©å±•ç‚¹æµ‹è¯•
- [ ] æ’ä»¶ç³»ç»Ÿé›†æˆæµ‹è¯•
- [ ] å‰ç«¯ç»„ä»¶å•å…ƒæµ‹è¯•
- [ ] E2E æµ‹è¯•ç”¨ä¾‹

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1  
**æœ€åæ›´æ–°**: 2026-01-24  
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µï¼Œç­‰å¾…æ¢ç´¢ agents å®Œæˆåè¡¥å……è¯¦ç»†è®¾è®¡

